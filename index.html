<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>RSM</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" type="image/png" href="rsm-header.png">
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&family=Playfair+Display:wght@500;700&display=swap" rel="stylesheet">
<style>
body{margin:0;font-family:'Montserrat',sans-serif;background:#0e0e11;color:#eaeaea;}
header{background:linear-gradient(rgba(0,0,0,.6),rgba(0,0,0,.9)),url('https://images.unsplash.com/photo-1500530855697-b586d89ba3ee');background-size:cover;background-position:center;padding:80px 20px;text-align:center;}
header h1{font-family:'Playfair Display',serif;font-size:52px;margin:0;}
nav{background:#15151c;padding:12px;display:flex;gap:15px;align-items:center;flex-wrap:wrap;}
nav a{cursor:pointer;font-weight:600;}
#searchBox{margin-left:auto;position:relative;}
#searchInput{padding:8px 10px;border-radius:20px;border:none;width:220px;}
#searchResults{position:absolute;top:38px;background:#1c1c25;width:100%;border-radius:10px;display:none;z-index:10;}
.search-item{padding:10px;cursor:pointer;}
.search-item:hover{background:#2a2a35;}
main{max-width:900px;margin:auto;padding:20px;}
.card{background:#1c1c25;padding:20px;border-radius:10px;margin-bottom:20px;}
.hidden{display:none}
#single img, #single iframe{max-width:100%;height:auto;object-fit:cover;border-radius:10px;margin:15px 0;}
#singleContent{line-height:1.7;}
#chatBox{display:none;position:fixed;bottom:20px;right:20px;width:350px;height:500px;background:#1c1c25;border-radius:10px;box-shadow:0 10px 25px rgba(0,0,0,0.4);overflow:hidden;flex-direction:column;z-index:1000;}
#chatMessages{flex-grow:1;padding:10px;overflow-y:auto;}
#chatInput{flex-grow:1;padding:10px;border:none;background:#0e0e11;color:#fff;outline:none;}
#chatSend{padding:0 15px;border:none;background:#ff4d4d;color:#fff;cursor:pointer;font-weight:600;}

/* Language Selector */
.language-selector {
    position: relative;
    margin-left: 15px;
}

.language-btn {
    padding: 8px 15px;
    background: #4da6ff;
    color: white;
    border: none;
    border-radius: 20px;
    cursor: pointer;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 8px;
}

.language-dropdown {
    position: absolute;
    top: 45px;
    right: 0;
    background: #1c1c25;
    border-radius: 10px;
    padding: 10px;
    min-width: 150px;
    display: none;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    z-index: 1001;
}

.language-option {
    padding: 8px 12px;
    cursor: pointer;
    border-radius: 5px;
    margin: 2px 0;
}

.language-option:hover {
    background: #2a2a35;
}

.current-lang {
    background: #4da6ff;
}
</style>

<!-- Webpushr -->
<script>
(function(w,d,s,id){
  if(typeof(w.webpushr)!=='undefined') return;
  w.webpushr=w.webpushr||function(){
    (w.webpushr.q=w.webpushr.q||[]).push(arguments)
  };
  var js,fjs=d.getElementsByTagName(s)[0];
  js=d.createElement(s); js.id=id; js.async=1;
  js.src="https://cdn.webpushr.com/app.min.js";
  js.onload=function(){
    webpushr('setup',{
      'key':'BKdp3zSvl_w5aJH_c9naFADnGMJxh9khCwh0THm4hfU-PGhMZN8V5XpQt0nAqFULqVBjWSUk6lWblBhDYRbhWt4'
    });
  };
  fjs.parentNode.appendChild(js);
}(window,document,'script','webpushr-jssdk'));
</script>
</head>

<body>
<header>
  <h1 id="siteTitle">RSM</h1>
</header>

<nav>
  <a onclick="showSection('home')" id="navHome">Home</a>
  <a onclick="showSection('articles')" id="navArticles">Articles</a>
  <a onclick="showSection('videos')" id="navVideos">Videos</a>
  <a onclick="showSection('news')" id="navNews">News</a>
  <a onclick="showSection('categories')" id="navCategories">Categories</a>
  <a onclick="showSection('about')" id="navAbout">About Us</a>
  <a onclick="showSection('contacts')" id="navContacts">Contacts</a>

  <div id="searchBox">
    <input id="searchInput" placeholder="Search..." oninput="searchAll()">
    <div id="searchResults"></div>
  </div>

  <!-- Language Selector -->
  <div class="language-selector">
    <button class="language-btn" onclick="toggleLanguageDropdown()">
      <span id="currentLangFlag">üåê</span>
      <span id="currentLangCode">EN</span>
    </button>
    <div class="language-dropdown" id="languageDropdown">
      <div class="language-option current-lang" onclick="changeLanguage('en')">üá∫üá∏ English</div>
      <div class="language-option" onclick="changeLanguage('it')">üáÆüáπ Italiano</div>
      <div class="language-option" onclick="changeLanguage('es')">üá™üá∏ Espa√±ol</div>
      <div class="language-option" onclick="changeLanguage('fr')">üá´üá∑ Fran√ßais</div>
      <div class="language-option" onclick="changeLanguage('de')">üá©üá™ Deutsch</div>
      <div class="language-option" onclick="changeLanguage('zh')">üá®üá≥ ‰∏≠Êñá</div>
      <div class="language-option" onclick="changeLanguage('ar')">üá∏üá¶ ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</div>
      <div class="language-option" onclick="changeLanguage('ru')">üá∑üá∫ –†—É—Å—Å–∫–∏–π</div>
    </div>
  </div>

 <!-- Chatbot AI -->
<div id="chatBotContainer" style="position:relative; margin-left:15px;">
  <button id="chatToggle" style="padding:8px 12px; border:none; border-radius:20px; background:#ff4d4d; color:#fff; cursor:pointer; font-weight:600;">
    <span id="chatBtnText">AI Chat</span>
  </button>
  
  <div id="chatBox" style="display:none; position:fixed; bottom:20px; right:20px; width:350px; height:500px; background:#1c1c25; border-radius:10px; box-shadow:0 10px 25px rgba(0,0,0,0.4); overflow:hidden; flex-direction:column; z-index:1000;">
    
    <div style="background:#15151c; padding:12px 15px; display:flex; align-items:center; border-bottom:1px solid #333;">
      <button id="chatClose" style="background:#ff4d4d; color:white; border:none; width:30px; height:30px; border-radius:50%; cursor:pointer; display:flex; align-items:center; justify-content:center; font-weight:bold; margin-right:10px;">
        √ó
      </button>
      <span style="color:#fff; font-weight:600;">ü§ñ <span id="chatTitle">RSM Assistant</span></span>
    </div>
    
    <div id="chatMessages" style="flex:1; overflow-y:auto; padding:15px;"></div>
    
    <div style="border-top:1px solid #333; padding:12px; background:#15151c;">
      <div style="display:flex; gap:8px;">
        <input id="chatInput" type="text" placeholder="Type here..." autocomplete="off" 
               style="flex:1; padding:10px; background:#0e0e11; color:#fff; border:none; border-radius:6px; outline:none;">
        <button id="chatSend" style="padding:0 15px; background:#4da6ff; color:#fff; border:none; border-radius:6px; cursor:pointer; font-weight:600;">
          <span id="sendBtnText">Send</span>
        </button>
      </div>
    </div>
  </div>
</div>
</nav>

<main>
<section id="home">
  <div id="latestNews" class="card" style="border-left:5px solid #ff4d4d">
    <h2>üü• <span id="latestNewsTitle">Latest News</span></h2>
    <h3 id="latestTitle"></h3>
    <p style="opacity:.7"><span id="clickNewsText">Click to read the full news</span></p>
  </div>
  <div id="latestVideo" class="card" style="border-left:5px solid #4da6ff">
    <h2>üé¨ <span id="latestVideoTitleText">Latest Video</span></h2>
    <h3 id="latestVideoTitle"></h3>
    <p style="opacity:.7"><span id="clickVideoText">Click to watch the full video</span></p>
  </div>
</section>

<section id="articles" class="hidden">
  <h2 id="articlesTitle">Articles</h2>
  <div id="articlesContainer"></div>
</section>

<section id="videos" class="hidden">
  <h2 id="videosTitle">Videos</h2>
  <div id="videosContainer"></div>
</section>

<section id="news" class="hidden">
  <h2 id="newsTitle">News</h2>
  <div id="newsContainer"></div>
</section>

<section id="categories" class="hidden">
  <h2 id="categoriesTitle">Categories</h2>
  <div id="categoriesContainer"></div>
</section>

<section id="about" class="hidden">
  <div class="card">
    <h2 id="aboutTitle">About Us</h2>
    <p id="publicDescription"></p>
  </div>
</section>

<section id="contacts" class="hidden">
  <div class="card">
    <h2 id="contactsTitle">Contacts</h2>
    <p>üìû +39 351 093 3272</p>
    <p>üìß rsm260511@gmail.com</p>
  </div>
</section>

<section id="single" class="hidden card">
  <h2 id="singleTitle"></h2>
  <p id="singleDate" style="opacity:.6;font-size:14px;margin-top:-10px"></p>
  <div id="singleImage"></div>
  <div id="singleContent"></div>
</section>
</main>

<footer style="text-align:center;padding:20px;font-size:14px;opacity:.6">
¬© 2025 ‚Äì RSM | <span id="footerText">All rights reserved</span>
</footer>

<script>
// ============ GLOBAL VARIABLES ============
let articles = [];
let currentLanguage = localStorage.getItem('rsm_language') || 'en';
let translations = {};

// ============ LANGUAGE SYSTEM ============
const languageData = {
  en: {
    name: "English",
    flag: "üá∫üá∏",
    translations: {
      siteTitle: "RSM",
      navHome: "Home",
      navArticles: "Articles",
      navVideos: "Videos",
      navNews: "News",
      navCategories: "Categories",
      navAbout: "About Us",
      navContacts: "Contacts",
      searchPlaceholder: "Search...",
      chatBtnText: "AI Chat",
      chatTitle: "RSM Assistant",
      sendBtnText: "Send",
      chatPlaceholder: "Type here...",
      latestNewsTitle: "Latest News",
      clickNewsText: "Click to read the full news",
      latestVideoTitleText: "Latest Video",
      clickVideoText: "Click to watch the full video",
      articlesTitle: "Articles",
      videosTitle: "Videos",
      newsTitle: "News",
      categoriesTitle: "Categories",
      aboutTitle: "About Us",
      contactsTitle: "Contacts",
      footerText: "All rights reserved",
      publishedOn: "Published on",
      botHello: "üëã Hello! I'm RSM Assistant. I can search information, summarize articles, translate between languages, perform calculations, convert currencies, tell jokes, and give advice!",
      changeLanguagePrompt: "‚ö†Ô∏è I notice you're speaking a different language. The site is currently set to English. Would you like me to change the language? Say 'change language to [language]' or click the language button in the top menu."
    }
  },
  it: {
    name: "Italiano",
    flag: "üáÆüáπ",
    translations: {
      siteTitle: "RSM",
      navHome: "Home",
      navArticles: "Articoli",
      navVideos: "Video",
      navNews: "Notizie",
      navCategories: "Categorie",
      navAbout: "Chi Siamo",
      navContacts: "Contatti",
      searchPlaceholder: "Cerca...",
      chatBtnText: "Chat AI",
      chatTitle: "Assistente RSM",
      sendBtnText: "Invia",
      chatPlaceholder: "Scrivi qui...",
      latestNewsTitle: "Ultime Notizie",
      clickNewsText: "Clicca per leggere la notizia completa",
      latestVideoTitleText: "Ultimo Video",
      clickVideoText: "Clicca per guardare il video completo",
      articlesTitle: "Articoli",
      videosTitle: "Video",
      newsTitle: "Notizie",
      categoriesTitle: "Categorie",
      aboutTitle: "Chi Siamo",
      contactsTitle: "Contatti",
      footerText: "Tutti i diritti riservati",
      publishedOn: "Pubblicato il",
      botHello: "üëã Ciao! Sono l'Assistente RSM. Posso cercare informazioni, riassumere articoli, tradurre tra lingue, fare calcoli, convertire valute, raccontare barzellette e dare consigli!",
      changeLanguagePrompt: "‚ö†Ô∏è Noto che stai parlando un'altra lingua. Il sito √® attualmente impostato in italiano. Vuoi che cambi la lingua? Di 'cambia lingua in [lingua]' o clicca il pulsante lingua nel menu in alto."
    }
  },
  es: {
    name: "Espa√±ol",
    flag: "üá™üá∏",
    translations: {
      siteTitle: "RSM",
      navHome: "Inicio",
      navArticles: "Art√≠culos",
      navVideos: "V√≠deos",
      navNews: "Noticias",
      navCategories: "Categor√≠as",
      navAbout: "Sobre Nosotros",
      navContacts: "Contactos",
      searchPlaceholder: "Buscar...",
      chatBtnText: "Chat IA",
      chatTitle: "Asistente RSM",
      sendBtnText: "Enviar",
      chatPlaceholder: "Escribe aqu√≠...",
      latestNewsTitle: "√öltimas Noticias",
      clickNewsText: "Haz clic para leer la noticia completa",
      latestVideoTitleText: "√öltimo V√≠deo",
      clickVideoText: "Haz clic para ver el v√≠deo completo",
      articlesTitle: "Art√≠culos",
      videosTitle: "V√≠deos",
      newsTitle: "Noticias",
      categoriesTitle: "Categor√≠as",
      aboutTitle: "Sobre Nosotros",
      contactsTitle: "Contactos",
      footerText: "Todos los derechos reservados",
      publishedOn: "Publicado el",
      botHello: "üëã ¬°Hola! Soy el Asistente RSM. ¬°Puedo buscar informaci√≥n, resumir art√≠culos, traducir entre idiomas, realizar c√°lculos, convertir monedas, contar chistes y dar consejos!",
      changeLanguagePrompt: "‚ö†Ô∏è Noto que est√°s hablando otro idioma. El sitio est√° actualmente configurado en espa√±ol. ¬øQuieres que cambie el idioma? Di 'cambiar idioma a [idioma]' o haz clic en el bot√≥n de idioma en el men√∫ superior."
    }
  },
  fr: {
    name: "Fran√ßais",
    flag: "üá´üá∑",
    translations: {
      siteTitle: "RSM",
      navHome: "Accueil",
      navArticles: "Articles",
      navVideos: "Vid√©os",
      navNews: "Actualit√©s",
      navCategories: "Cat√©gories",
      navAbout: "√Ä Propos",
      navContacts: "Contacts",
      searchPlaceholder: "Rechercher...",
      chatBtnText: "Chat IA",
      chatTitle: "Assistant RSM",
      sendBtnText: "Envoyer",
      chatPlaceholder: "√âcrivez ici...",
      latestNewsTitle: "Derni√®res Actualit√©s",
      clickNewsText: "Cliquez pour lire l'actualit√© compl√®te",
      latestVideoTitleText: "Derni√®re Vid√©o",
      clickVideoText: "Cliquez pour regarder la vid√©o compl√®te",
      articlesTitle: "Articles",
      videosTitle: "Vid√©os",
      newsTitle: "Actualit√©s",
      categoriesTitle: "Cat√©gories",
      aboutTitle: "√Ä Propos",
      contactsTitle: "Contacts",
      footerText: "Tous droits r√©serv√©s",
      publishedOn: "Publi√© le",
      botHello: "üëã Bonjour ! Je suis l'Assistant RSM. Je peux rechercher des informations, r√©sumer des articles, traduire entre les langues, effectuer des calculs, convertir des devises, raconter des blagues et donner des conseils !",
      changeLanguagePrompt: "‚ö†Ô∏è Je remarque que vous parlez une autre langue. Le site est actuellement configur√© en fran√ßais. Voulez-vous que je change la langue ? Dites 'changer la langue en [langue]' ou cliquez sur le bouton de langue dans le menu sup√©rieur."
    }
  },
  de: {
    name: "Deutsch",
    flag: "üá©üá™",
    translations: {
      siteTitle: "RSM",
      navHome: "Startseite",
      navArticles: "Artikel",
      navVideos: "Videos",
      navNews: "Nachrichten",
      navCategories: "Kategorien",
      navAbout: "√úber Uns",
      navContacts: "Kontakte",
      searchPlaceholder: "Suchen...",
      chatBtnText: "KI Chat",
      chatTitle: "RSM Assistent",
      sendBtnText: "Senden",
      chatPlaceholder: "Hier schreiben...",
      latestNewsTitle: "Neueste Nachrichten",
      clickNewsText: "Klicken Sie, um die vollst√§ndige Nachricht zu lesen",
      latestVideoTitleText: "Neuestes Video",
      clickVideoText: "Klicken Sie, um das vollst√§ndige Video anzusehen",
      articlesTitle: "Artikel",
      videosTitle: "Videos",
      newsTitle: "Nachrichten",
      categoriesTitle: "Kategorien",
      aboutTitle: "√úber Uns",
      contactsTitle: "Kontakte",
      footerText: "Alle Rechte vorbehalten",
      publishedOn: "Ver√∂ffentlicht am",
      botHello: "üëã Hallo! Ich bin der RSM-Assistent. Ich kann Informationen suchen, Artikel zusammenfassen, zwischen Sprachen √ºbersetzen, Berechnungen durchf√ºhren, W√§hrungen umrechnen, Witze erz√§hlen und Ratschl√§ge geben!",
      changeLanguagePrompt: "‚ö†Ô∏è Ich bemerke, dass Sie eine andere Sprache sprechen. Die Seite ist derzeit auf Deutsch eingestellt. M√∂chten Sie, dass ich die Sprache √§ndere? Sagen Sie 'Sprache √§ndern zu [Sprache]' oder klicken Sie auf die Sprachschaltfl√§che im oberen Men√º."
    }
  },
  zh: {
    name: "‰∏≠Êñá",
    flag: "üá®üá≥",
    translations: {
      siteTitle: "RSM",
      navHome: "È¶ñÈ°µ",
      navArticles: "ÊñáÁ´†",
      navVideos: "ËßÜÈ¢ë",
      navNews: "Êñ∞Èóª",
      navCategories: "ÂàÜÁ±ª",
      navAbout: "ÂÖ≥‰∫éÊàë‰ª¨",
      navContacts: "ËÅîÁ≥ªÊñπÂºè",
      searchPlaceholder: "ÊêúÁ¥¢...",
      chatBtnText: "AIËÅäÂ§©",
      chatTitle: "RSMÂä©Êâã",
      sendBtnText: "ÂèëÈÄÅ",
      chatPlaceholder: "Âú®ËøôÈáåËæìÂÖ•...",
      latestNewsTitle: "ÊúÄÊñ∞Êñ∞Èóª",
      clickNewsText: "ÁÇπÂáªÈòÖËØªÂÆåÊï¥Êñ∞Èóª",
      latestVideoTitleText: "ÊúÄÊñ∞ËßÜÈ¢ë",
      clickVideoText: "ÁÇπÂáªËßÇÁúãÂÆåÊï¥ËßÜÈ¢ë",
      articlesTitle: "ÊñáÁ´†",
      videosTitle: "ËßÜÈ¢ë",
      newsTitle: "Êñ∞Èóª",
      categoriesTitle: "ÂàÜÁ±ª",
      aboutTitle: "ÂÖ≥‰∫éÊàë‰ª¨",
      contactsTitle: "ËÅîÁ≥ªÊñπÂºè",
      footerText: "ÁâàÊùÉÊâÄÊúâ",
      publishedOn: "ÂèëÂ∏É‰∫é",
      botHello: "üëã ‰Ω†Â•ΩÔºÅÊàëÊòØRSMÂä©Êâã„ÄÇÊàëÂèØ‰ª•ÊêúÁ¥¢‰ø°ÊÅØ„ÄÅÊÄªÁªìÊñáÁ´†„ÄÅÁøªËØëËØ≠Ë®Ä„ÄÅËøõË°åËÆ°ÁÆó„ÄÅÂÖëÊç¢Ë¥ßÂ∏Å„ÄÅËÆ≤Á¨ëËØùÂíåÊèê‰æõÂª∫ËÆÆÔºÅ",
      changeLanguagePrompt: "‚ö†Ô∏è ÊàëÊ≥®ÊÑèÂà∞ÊÇ®Âú®‰ΩøÁî®ÂÖ∂‰ªñËØ≠Ë®Ä„ÄÇÁΩëÁ´ôÂΩìÂâçËÆæÁΩÆ‰∏∫‰∏≠Êñá„ÄÇÊÇ®ÊÉ≥Ë¶ÅÊõ¥ÊîπËØ≠Ë®ÄÂêóÔºüËØ¥'Êõ¥ÊîπËØ≠Ë®Ä‰∏∫[ËØ≠Ë®Ä]'ÊàñÁÇπÂáªÈ°∂ÈÉ®ËèúÂçï‰∏≠ÁöÑËØ≠Ë®ÄÊåâÈíÆ„ÄÇ"
    }
  },
  ar: {
    name: "ÿßŸÑÿπÿ±ÿ®Ÿäÿ©",
    flag: "üá∏üá¶",
    translations: {
      siteTitle: "RSM",
      navHome: "ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©",
      navArticles: "ÿßŸÑŸÖŸÇÿßŸÑÿßÿ™",
      navVideos: "ÿßŸÑŸÅŸäÿØŸäŸàŸáÿßÿ™",
      navNews: "ÿßŸÑÿ£ÿÆÿ®ÿßÿ±",
      navCategories: "ÿßŸÑŸÅÿ¶ÿßÿ™",
      navAbout: "ŸÖŸÜ ŸÜÿ≠ŸÜ",
      navContacts: "ÿßÿ™ÿµŸÑ ÿ®ŸÜÿß",
      searchPlaceholder: "ÿ®ÿ≠ÿ´...",
      chatBtnText: "ÿØÿ±ÿØÿ¥ÿ© ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä",
      chatTitle: "ŸÖÿ≥ÿßÿπÿØ RSM",
      sendBtnText: "ÿ•ÿ±ÿ≥ÿßŸÑ",
      chatPlaceholder: "ÿßŸÉÿ™ÿ® ŸáŸÜÿß...",
      latestNewsTitle: "ÿ¢ÿÆÿ± ÿßŸÑÿ£ÿÆÿ®ÿßÿ±",
      clickNewsText: "ÿßŸÜŸÇÿ± ŸÑŸÇÿ±ÿßÿ°ÿ© ÿßŸÑÿÆÿ®ÿ± ÿßŸÑŸÉÿßŸÖŸÑ",
      latestVideoTitleText: "ÿ¢ÿÆÿ± ŸÅŸäÿØŸäŸà",
      clickVideoText: "ÿßŸÜŸÇÿ± ŸÑŸÖÿ¥ÿßŸáÿØÿ© ÿßŸÑŸÅŸäÿØŸäŸà ÿßŸÑŸÉÿßŸÖŸÑ",
      articlesTitle: "ÿßŸÑŸÖŸÇÿßŸÑÿßÿ™",
      videosTitle: "ÿßŸÑŸÅŸäÿØŸäŸàŸáÿßÿ™",
      newsTitle: "ÿßŸÑÿ£ÿÆÿ®ÿßÿ±",
      categoriesTitle: "ÿßŸÑŸÅÿ¶ÿßÿ™",
      aboutTitle: "ŸÖŸÜ ŸÜÿ≠ŸÜ",
      contactsTitle: "ÿßÿ™ÿµŸÑ ÿ®ŸÜÿß",
      footerText: "ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÇ ŸÖÿ≠ŸÅŸàÿ∏ÿ©",
      publishedOn: "ŸÜÿ¥ÿ± ŸÅŸä",
      botHello: "üëã ŸÖÿ±ÿ≠ÿ®ÿßŸã! ÿ£ŸÜÿß ŸÖÿ≥ÿßÿπÿØ RSM. ŸäŸÖŸÉŸÜŸÜŸä ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜ ÿßŸÑŸÖÿπŸÑŸàŸÖÿßÿ™ Ÿàÿ™ŸÑÿÆŸäÿµ ÿßŸÑŸÖŸÇÿßŸÑÿßÿ™ ŸàÿßŸÑÿ™ÿ±ÿ¨ŸÖÿ© ÿ®ŸäŸÜ ÿßŸÑŸÑÿ∫ÿßÿ™ Ÿàÿ•ÿ¨ÿ±ÿßÿ° ÿßŸÑÿπŸÖŸÑŸäÿßÿ™ ÿßŸÑÿ≠ÿ≥ÿßÿ®Ÿäÿ© Ÿàÿ™ÿ≠ŸàŸäŸÑ ÿßŸÑÿπŸÖŸÑÿßÿ™ Ÿàÿ•ŸÑŸÇÿßÿ° ÿßŸÑŸÜŸÉÿßÿ™ Ÿàÿ™ŸÇÿØŸäŸÖ ÿßŸÑŸÜÿµÿßÿ¶ÿ≠!",
      changeLanguagePrompt: "‚ö†Ô∏è ÿ£ŸÑÿßÿ≠ÿ∏ ÿ£ŸÜŸÉ ÿ™ÿ™ÿ≠ÿØÿ´ ŸÑÿ∫ÿ© ŸÖÿÆÿ™ŸÑŸÅÿ©. ÿßŸÑŸÖŸàŸÇÿπ ŸÖÿ∂ÿ®Ÿàÿ∑ ÿ≠ÿßŸÑŸäŸãÿß ÿπŸÑŸâ ÿßŸÑÿπÿ±ÿ®Ÿäÿ©. ŸáŸÑ ÿ™ÿ±ŸäÿØŸÜŸä ÿ£ŸÜ ÿ£ÿ∫Ÿäÿ± ÿßŸÑŸÑÿ∫ÿ©ÿü ŸÇŸÑ 'ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸÑÿ∫ÿ© ÿ•ŸÑŸâ [ÿßŸÑŸÑÿ∫ÿ©]' ÿ£Ÿà ÿßŸÜŸÇÿ± ÿπŸÑŸâ ÿ≤ÿ± ÿßŸÑŸÑÿ∫ÿ© ŸÅŸä ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿπŸÑŸàŸäÿ©."
    }
  },
  ru: {
    name: "–†—É—Å—Å–∫–∏–π",
    flag: "üá∑üá∫",
    translations: {
      siteTitle: "RSM",
      navHome: "–ì–ª–∞–≤–Ω–∞—è",
      navArticles: "–°—Ç–∞—Ç—å–∏",
      navVideos: "–í–∏–¥–µ–æ",
      navNews: "–ù–æ–≤–æ—Å—Ç–∏",
      navCategories: "–ö–∞—Ç–µ–≥–æ—Ä–∏–∏",
      navAbout: "–û –Ω–∞—Å",
      navContacts: "–ö–æ–Ω—Ç–∞–∫—Ç—ã",
      searchPlaceholder: "–ü–æ–∏—Å–∫...",
      chatBtnText: "–ò–ò –ß–∞—Ç",
      chatTitle: "–ü–æ–º–æ—â–Ω–∏–∫ RSM",
      sendBtnText: "–û—Ç–ø—Ä–∞–≤–∏—Ç—å",
      chatPlaceholder: "–í–≤–µ–¥–∏—Ç–µ –∑–¥–µ—Å—å...",
      latestNewsTitle: "–ü–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏",
      clickNewsText: "–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –ø—Ä–æ—á–∏—Ç–∞—Ç—å –ø–æ–ª–Ω—É—é –Ω–æ–≤–æ—Å—Ç—å",
      latestVideoTitleText: "–ü–æ—Å–ª–µ–¥–Ω–µ–µ –≤–∏–¥–µ–æ",
      clickVideoText: "–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ–ª–Ω–æ–µ –≤–∏–¥–µ–æ",
      articlesTitle: "–°—Ç–∞—Ç—å–∏",
      videosTitle: "–í–∏–¥–µ–æ",
      newsTitle: "–ù–æ–≤–æ—Å—Ç–∏",
      categoriesTitle: "–ö–∞—Ç–µ–≥–æ—Ä–∏–∏",
      aboutTitle: "–û –Ω–∞—Å",
      contactsTitle: "–ö–æ–Ω—Ç–∞–∫—Ç—ã",
      footerText: "–í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã",
      publishedOn: "–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ",
      botHello: "üëã –ü—Ä–∏–≤–µ—Ç! –Ø –ø–æ–º–æ—â–Ω–∏–∫ RSM. –Ø –º–æ–≥—É –∏—Å–∫–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é, —Å—É–º–º–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ç—å–∏, –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—å –º–µ–∂–¥—É —è–∑—ã–∫–∞–º–∏, –≤—ã–ø–æ–ª–Ω—è—Ç—å –≤—ã—á–∏—Å–ª–µ–Ω–∏—è, –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–∞–ª—é—Ç—ã, —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞—Ç—å –∞–Ω–µ–∫–¥–æ—Ç—ã –∏ –¥–∞–≤–∞—Ç—å —Å–æ–≤–µ—Ç—ã!",
      changeLanguagePrompt: "‚ö†Ô∏è –Ø –∑–∞–º–µ—Ç–∏–ª, —á—Ç–æ –≤—ã –≥–æ–≤–æ—Ä–∏—Ç–µ –Ω–∞ –¥—Ä—É–≥–æ–º —è–∑—ã–∫–µ. –°–∞–π—Ç –≤ –Ω–∞—Å—Ç–æ—è—â–µ–µ –≤—Ä–µ–º—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞ —Ä—É—Å—Å–∫–∏–π. –•–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã —è –∏–∑–º–µ–Ω–∏–ª —è–∑—ã–∫? –°–∫–∞–∂–∏—Ç–µ '–∏–∑–º–µ–Ω–∏—Ç—å —è–∑—ã–∫ –Ω–∞ [—è–∑—ã–∫]' –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É —è–∑—ã–∫–∞ –≤ –≤–µ—Ä—Ö–Ω–µ–º –º–µ–Ω—é."
    }
  }
};

// ============ INITIALIZATION ============
function initApp() {
  // Load articles first
  fetch('https://raw.githubusercontent.com/rsm260511-web/RSM/main/data.json')
  .then(r=>r.json())
  .then(data=>{
    articles = data.articles;
    // Set current language and update UI
    applyLanguage(currentLanguage);
    renderAllContent();
  });
}

// ============ LANGUAGE FUNCTIONS ============
function toggleLanguageDropdown() {
  const dropdown = document.getElementById('languageDropdown');
  dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
}

function changeLanguage(langCode) {
  if (languageData[langCode]) {
    currentLanguage = langCode;
    localStorage.setItem('rsm_language', langCode);
    applyLanguage(langCode);
    toggleLanguageDropdown();
    
    // Update bot language
    botLanguage = langCode;
    
    // Add welcome message in new language
    if (chatMessages.children.length === 0) {
      appendMessage('bot', languageData[langCode].translations.botHello);
    }
    
    // Re-render all content
    renderAllContent();
  }
}

function applyLanguage(langCode) {
  const lang = languageData[langCode];
  if (!lang) return;
  
  // Update UI elements
  document.getElementById('currentLangFlag').textContent = lang.flag;
  document.getElementById('currentLangCode').textContent = langCode.toUpperCase();
  document.documentElement.lang = langCode;
  
  // Apply translations
  const t = lang.translations;
  for (const [key, value] of Object.entries(t)) {
    const element = document.getElementById(key);
    if (element) {
      element.textContent = value;
    }
  }
  
  // Update placeholders
  document.getElementById('searchInput').placeholder = t.searchPlaceholder;
  document.getElementById('chatInput').placeholder = t.chatPlaceholder;
  
  // Update language dropdown options
  updateLanguageDropdown();
}

function updateLanguageDropdown() {
  const dropdown = document.getElementById('languageDropdown');
  dropdown.innerHTML = '';
  
  for (const [code, lang] of Object.entries(languageData)) {
    const option = document.createElement('div');
    option.className = 'language-option';
    if (code === currentLanguage) {
      option.classList.add('current-lang');
    }
    option.innerHTML = `${lang.flag} ${lang.name}`;
    option.onclick = () => changeLanguage(code);
    dropdown.appendChild(option);
  }
}

// ============ RENDER FUNCTIONS ============
function renderAllContent() {
  renderArticles();
  renderVideos();
  renderNews();
  renderCategories();
  renderLatestNews();
  renderLatestVideo();
}

function renderArticles() {
  const container = document.getElementById('articlesContainer');
  if (!container) return;
  
  container.innerHTML = '';
  articles.filter(a => a.type === "article").forEach(a => {
    const i = articles.indexOf(a);
    const d = document.createElement('div');
    d.className = 'card';
    d.innerHTML = `<h3>${a.title}</h3><p>${a.date ? new Date(a.date).toLocaleDateString(currentLanguage) : ''}</p>`;
    d.onclick = () => openArticle(i);
    container.appendChild(d);
  });
}

function renderVideos() {
  const container = document.getElementById('videosContainer');
  if (!container) return;
  
  container.innerHTML = '';
  articles.filter(a => a.type === "video").forEach(a => {
    const i = articles.indexOf(a);
    const d = document.createElement('div');
    d.className = 'card';
    d.innerHTML = `<h3>${a.title}</h3><p>${a.date ? new Date(a.date).toLocaleDateString(currentLanguage) : ''}</p>`;
    d.onclick = () => openVideo(i);
    container.appendChild(d);
  });
}

function renderNews() {
  const container = document.getElementById('newsContainer');
  if (!container) return;
  
  container.innerHTML = '';
  articles.filter(a => a.type === "news").forEach(a => {
    const i = articles.indexOf(a);
    const d = document.createElement('div');
    d.className = 'card';
    d.innerHTML = `<h3>${a.title}</h3><p>${a.date ? new Date(a.date).toLocaleDateString(currentLanguage) : ''}</p>`;
    d.onclick = () => openArticle(i);
    container.appendChild(d);
  });
}

function renderCategories() {
  const container = document.getElementById('categoriesContainer');
  if (!container) return;
  
  container.innerHTML = '';
  [...new Set(articles.map(a => a.category))].forEach(cat => {
    const box = document.createElement('div');
    box.className = 'card';
    box.innerHTML = `<h3>${cat}</h3>`;
    articles.filter(a => a.category === cat).forEach(a => {
      const i = articles.indexOf(a);
      const p = document.createElement('p');
      p.style.cursor = 'pointer';
      p.innerText = "‚Ä¢ " + a.title;
      p.onclick = () => {
        if (a.type === "video") {
          openVideo(i);
        } else {
          openArticle(i);
        }
      };
      box.appendChild(p);
    });
    container.appendChild(box);
  });
}

// ============ NAVIGATION ============
function showSection(id) {
  document.querySelectorAll('main section').forEach(s => s.classList.add('hidden'));
  const section = document.getElementById(id);
  if (section) {
    section.classList.remove('hidden');
  }
  window.scrollTo(0, 0);
}

function openArticle(i) {
  const a = articles[i];
  showSection('single');
  document.getElementById('singleTitle').textContent = a.title;
  
  const dateText = languageData[currentLanguage].translations.publishedOn || "Published on";
  document.getElementById('singleDate').textContent = a.date ? 
    `üìÖ ${dateText} ${new Date(a.date).toLocaleDateString(currentLanguage)}` : "";
  
  const imgBox = document.getElementById('singleImage');
  imgBox.innerHTML = '';
  
  if (a.images && Array.isArray(a.images)) {
    a.images.forEach(src => {
      const img = document.createElement('img');
      img.src = src;
      imgBox.appendChild(img);
    });
  } else if (a.image) {
    imgBox.innerHTML = `<img src="${a.image}">`;
  }
  
  document.getElementById('singleContent').innerHTML = `<p>${a.content.replace(/\n/g, "<br><br>")}</p>`;
}

function openVideo(i) {
  const a = articles[i];
  showSection('single');
  document.getElementById('singleTitle').textContent = a.title;
  
  const dateText = languageData[currentLanguage].translations.publishedOn || "Published on";
  document.getElementById('singleDate').textContent = a.date ? 
    `üìÖ ${dateText} ${new Date(a.date).toLocaleDateString(currentLanguage)}` : "";
  
  const imgBox = document.getElementById('singleImage');
  imgBox.innerHTML = '';
  
  if (a.videoUrl) {
    imgBox.innerHTML = `
      <div style="width:100%; max-width:100%; margin:20px 0;">
        <iframe width="100%" height="200" src="${a.videoUrl}" 
                frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                allowfullscreen style="border-radius:10px;">
        </iframe>
      </div>
    `;
  } else if (a.images && Array.isArray(a.images)) {
    a.images.forEach(src => {
      const img = document.createElement('img');
      img.src = src;
      imgBox.appendChild(img);
    });
  }
  
  document.getElementById('singleContent').innerHTML = `<p>${a.content.replace(/\n/g, "<br><br>")}</p>`;
}

// ============ SEARCH ============
function searchAll() {
  const q = document.getElementById('searchInput').value.toLowerCase();
  const box = document.getElementById('searchResults');
  box.innerHTML = '';
  
  if (!q) {
    box.style.display = 'none';
    return;
  }
  
  articles.forEach((a, i) => {
    if (a.title.toLowerCase().includes(q) || a.content.toLowerCase().includes(q)) {
      const d = document.createElement('div');
      d.className = 'search-item';
      d.textContent = a.title;
      d.onclick = () => {
        if (a.type === "video") {
          openVideo(i);
        } else {
          openArticle(i);
        }
      };
      box.appendChild(d);
    }
  });
  
  box.style.display = box.children.length ? 'block' : 'none';
}

// ============ LATEST NEWS & VIDEO ============
function renderLatestNews() {
  const news = articles.filter(a => a.type === "news")
    .sort((a, b) => new Date(b.date) - new Date(a.date))[0];
  
  if (!news) return;
  
  document.getElementById('latestTitle').textContent = news.title;
  const i = articles.findIndex(a => a.title === news.title);
  document.getElementById('latestNews').onclick = () => openArticle(i);
}

function renderLatestVideo() {
  const video = articles.filter(a => a.type === "video")
    .sort((a, b) => new Date(b.date) - new Date(a.date))[0];
  
  if (!video) return;
  
  document.getElementById('latestVideoTitle').textContent = video.title;
  const i = articles.findIndex(a => a.title === video.title);
  document.getElementById('latestVideo').onclick = () => openVideo(i);
}

// ============ CHATBOT AI ============
const chatToggle = document.getElementById('chatToggle');
const chatBox = document.getElementById('chatBox');
const chatMessages = document.getElementById('chatMessages');
const chatInput = document.getElementById('chatInput');
const chatSend = document.getElementById('chatSend');
const chatClose = document.getElementById('chatClose');

let lastQuestion = null;
let botLanguage = currentLanguage;

// Language detection patterns
const languagePatterns = {
  en: /\b(hello|hi|hey|good|morning|afternoon|evening|thanks|thank you|please|sorry|excuse me|how are you|what's up|hey there)\b/i,
  it: /\b(ciao|buongiorno|buonasera|salve|grazie|prego|scusa|mi scusi|come stai|come va|tutto bene|per favore|arrivederci|ciao ciao)\b/i,
  es: /\b(hola|buenos d√≠as|buenas tardes|buenas noches|gracias|por favor|perd√≥n|disculpa|¬øc√≥mo est√°s?|¬øqu√© tal?|adi√≥s|hasta luego|hasta pronto)\b/i,
  fr: /\b(bonjour|salut|bonsoir|merci|s'il vous pla√Æt|excusez-moi|pardon|comment √ßa va?|√ßa va?|au revoir|√† bient√¥t|bonne journ√©e)\b/i,
  de: /\b(hallo|guten tag|guten morgen|guten abend|danke|bitte|entschuldigung|wie geht's?|wie geht es dir?|tsch√ºss|auf wiedersehen|bis bald)\b/i,
  zh: /\b(‰Ω†Â•Ω|Âó®|Êó©‰∏äÂ•Ω|‰∏ãÂçàÂ•Ω|Êôö‰∏äÂ•Ω|Ë∞¢Ë∞¢|ËØ∑|ÂØπ‰∏çËµ∑|‰∏çÂ•ΩÊÑèÊÄù|ÊúÄËøëÊÄé‰πàÊ†∑|ÂÜçËßÅ|ÊãúÊãú|ÊòéÂ§©ËßÅ)\b/,
  ar: /\b(ŸÖÿ±ÿ≠ÿ®ÿß|ÿ£ŸáŸÑÿß|ÿµÿ®ÿßÿ≠ ÿßŸÑÿÆŸäÿ±|ŸÖÿ≥ÿßÿ° ÿßŸÑÿÆŸäÿ±|ÿ¥ŸÉÿ±ÿß|ŸÖŸÜ ŸÅÿ∂ŸÑŸÉ|ÿ¢ÿ≥ŸÅ|ŸÖÿπÿ∞ÿ±ÿ©|ŸÉŸäŸÅ ÿ≠ÿßŸÑŸÉ|ŸÖÿπ ÿßŸÑÿ≥ŸÑÿßŸÖÿ©|ÿ•ŸÑŸâ ÿßŸÑŸÑŸÇÿßÿ°|ŸàÿØÿßÿπÿß)\b/,
  ru: /\b(–ø—Ä–∏–≤–µ—Ç|–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ|–¥–æ–±—Ä–æ–µ —É—Ç—Ä–æ|–¥–æ–±—Ä—ã–π –¥–µ–Ω—å|–¥–æ–±—Ä—ã–π –≤–µ—á–µ—Ä|—Å–ø–∞—Å–∏–±–æ|–ø–æ–∂–∞–ª—É–π—Å—Ç–∞|–∏–∑–≤–∏–Ω–∏—Ç–µ|–ø—Ä–æ—Å—Ç–∏—Ç–µ|–∫–∞–∫ –¥–µ–ª–∞?|–¥–æ —Å–≤–∏–¥–∞–Ω–∏—è|–ø–æ–∫–∞)\b/
};

// Open/Close chat
chatToggle.addEventListener('click', () => {
  chatBox.style.display = chatBox.style.display === 'flex' ? 'none' : 'flex';
  if (chatBox.style.display === 'flex') chatInput.focus();
});

chatClose.addEventListener('click', () => {
  chatBox.style.display = 'none';
});

// Add message
function appendMessage(sender, text) {
  const div = document.createElement('div');
  div.innerHTML = text.replace(/\n/g, '<br>');
  div.style.margin = '5px';
  div.style.padding = '8px 12px';
  div.style.borderRadius = '15px';
  div.style.maxWidth = '80%';
  div.style.wordWrap = 'break-word';
  div.style.alignSelf = sender === 'user' ? 'flex-end' : 'flex-start';
  div.style.background = sender === 'user' ? '#007bff' : '#333';
  div.style.color = '#fff';
  chatMessages.appendChild(div);
  chatMessages.scrollTop = chatMessages.scrollHeight;
}

// Send message
async function sendMessage() {
  const msg = chatInput.value.trim();
  if (!msg) return;
  
  appendMessage('user', msg);
  
  // Detect if user is speaking different language
  const detectedLang = detectLanguage(msg);
  if (detectedLang && detectedLang !== botLanguage && !msg.toLowerCase().includes("translate") && !msg.toLowerCase().includes("traduci")) {
    const prompt = languageData[botLanguage].translations.changeLanguagePrompt;
    appendMessage('bot', prompt);
    chatInput.value = '';
    chatInput.focus();
    return;
  }
  
  // AI Response
  const botReply = await botResponse(msg);
  appendMessage('bot', botReply);
  
  chatInput.value = '';
  chatInput.focus();
}

chatSend.addEventListener('click', sendMessage);
chatInput.addEventListener('keypress', e => {
  if (e.key === 'Enter') sendMessage();
});

function randomChoice(arr) {
  return arr[Math.floor(Math.random() * arr.length)];
}

// Detect language from text
function detectLanguage(text) {
  for (const [lang, pattern] of Object.entries(languagePatterns)) {
    if (pattern.test(text)) {
      return lang;
    }
  }
  return null;
}

// ============ WIKIPEDIA SEARCH ============
async function wikipediaSearch(query) {
  try {
    // Use language-specific Wikipedia
    const langCode = botLanguage === 'zh' ? 'zh' : botLanguage;
    const searchUrl = `https://${langCode}.wikipedia.org/w/api.php?action=query&list=search&srsearch=${encodeURIComponent(query)}&format=json&origin=*&srlimit=1`;
    
    const searchResponse = await fetch(searchUrl);
    const searchData = await searchResponse.json();
    
    if (!searchData.query?.search?.length) {
      return getTranslation("searchNotFound");
    }
    
    const pageTitle = searchData.query.search[0].title;
    const contentUrl = `https://${langCode}.wikipedia.org/w/api.php?action=query&prop=extracts&exintro=true&explaintext=true&titles=${encodeURIComponent(pageTitle)}&format=json&origin=*`;
    
    const contentResponse = await fetch(contentUrl);
    const contentData = await contentResponse.json();
    
    const pages = contentData.query.pages;
    const pageId = Object.keys(pages)[0];
    
    if (pageId === "-1" || !pages[pageId].extract) {
      return `üìö **${pageTitle}**\n\n${getTranslation("limitedInfo")}`;
    }
    
    const extract = pages[pageId].extract;
    const shortExtract = extract.length > 400 ? extract.substring(0, 400) + "..." : extract;
    
    return `üìö **${pageTitle}**\n\n${shortExtract}`;
    
  } catch (error) {
    return getTranslation("searchError");
  }
}

// ============ TRANSLATION API ============
async function translateText(text, targetLang) {
  try {
    // Use Google Translate API (unofficial but reliable)
    const sourceLang = detectLanguage(text) || 'auto';
    const encodedText = encodeURIComponent(text);
    
    const response = await fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=${sourceLang}&tl=${targetLang}&dt=t&q=${encodedText}`);
    
    if (!response.ok) throw new Error("Translation failed");
    
    const data = await response.json();
    
    if (data && data[0] && data[0][0] && data[0][0][0]) {
      return {
        translated: data[0][0][0],
        detected: sourceLang,
        success: true
      };
    }
    
    throw new Error("No translation found");
  } catch (error) {
    // Fallback to simple word mapping for common phrases
    const commonTranslations = {
      'hello': { en: 'hello', it: 'ciao', es: 'hola', fr: 'bonjour', de: 'hallo', zh: '‰Ω†Â•Ω', ar: 'ŸÖÿ±ÿ≠ÿ®ÿß', ru: '–ø—Ä–∏–≤–µ—Ç' },
      'thank you': { en: 'thank you', it: 'grazie', es: 'gracias', fr: 'merci', de: 'danke', zh: 'Ë∞¢Ë∞¢', ar: 'ÿ¥ŸÉÿ±ÿß', ru: '—Å–ø–∞—Å–∏–±–æ' },
      'goodbye': { en: 'goodbye', it: 'arrivederci', es: 'adi√≥s', fr: 'au revoir', de: 'auf wiedersehen', zh: 'ÂÜçËßÅ', ar: 'ŸÖÿπ ÿßŸÑÿ≥ŸÑÿßŸÖÿ©', ru: '–¥–æ —Å–≤–∏–¥–∞–Ω–∏—è' },
      'yes': { en: 'yes', it: 's√¨', es: 's√≠', fr: 'oui', de: 'ja', zh: 'ÊòØÁöÑ', ar: 'ŸÜÿπŸÖ', ru: '–¥–∞' },
      'no': { en: 'no', it: 'no', es: 'no', fr: 'non', de: 'nein', zh: '‰∏ç', ar: 'ŸÑÿß', ru: '–Ω–µ—Ç' }
    };
    
    const lowerText = text.toLowerCase();
    for (const [key, translations] of Object.entries(commonTranslations)) {
      if (lowerText.includes(key) && translations[targetLang]) {
        return {
          translated: translations[targetLang],
          detected: 'en',
          success: true
        };
      }
    }
    
    return {
      translated: text,
      detected: 'unknown',
      success: false,
      error: "Could not translate"
    };
  }
}

// ============ CURRENCY EXCHANGE ============
async function getExchangeRate(fromCurrency, toCurrency, amount = 1) {
  try {
    // Fix currency codes
    const from = fromCurrency.toUpperCase();
    const to = toCurrency.toUpperCase();
    
    // Common currency mapping
    const currencyMap = {
      'EURO': 'EUR', 'EUR': 'EUR',
      'DOLLAR': 'USD', 'USD': 'USD', 'US DOLLAR': 'USD',
      'POUND': 'GBP', 'GBP': 'GBP', 'STERLING': 'GBP',
      'PKR': 'PKR', 'RUPEE': 'PKR',
      'YEN': 'JPY', 'JPY': 'JPY',
      'YUAN': 'CNY', 'CNY': 'CNY',
      'RUBLE': 'RUB', 'RUB': 'RUB'
    };
    
    const fromCode = currencyMap[from] || from;
    const toCode = currencyMap[to] || to;
    
    // Try first API
    const response = await fetch(`https://api.exchangerate-api.com/v4/latest/${fromCode}`);
    if (!response.ok) throw new Error("API 1 failed");
    
    const data = await response.json();
    
    if (data.rates && data.rates[toCode]) {
      const rate = data.rates[toCode];
      const converted = (amount * rate).toFixed(2);
      return {
        success: true,
        result: `${amount} ${fromCode} = ${converted} ${toCode}`,
        rate: rate,
        details: `${getTranslation("exchangeRate")} 1 ${fromCode} = ${rate.toFixed(4)} ${toCode}`
      };
    }
    
    throw new Error("Currency not found");
  } catch (error) {
    // Fallback to fixed rates for common conversions
    const fixedRates = {
      'EUR_PKR': 299.5,
      'USD_PKR': 278.5,
      'EUR_USD': 1.09,
      'USD_EUR': 0.92,
      'EUR_GBP': 0.86,
      'GBP_EUR': 1.16,
      'USD_GBP': 0.79,
      'GBP_USD': 1.27
    };
    
    const key = `${fromCurrency.toUpperCase()}_${toCurrency.toUpperCase()}`;
    const reverseKey = `${toCurrency.toUpperCase()}_${fromCurrency.toUpperCase()}`;
    
    if (fixedRates[key]) {
      const rate = fixedRates[key];
      const converted = (amount * rate).toFixed(2);
      return {
        success: true,
        result: `${amount} ${fromCurrency.toUpperCase()} = ${converted} ${toCurrency.toUpperCase()}`,
        rate: rate,
        details: `${getTranslation("exchangeRate")} 1 ${fromCurrency.toUpperCase()} = ${rate.toFixed(4)} ${toCurrency.toUpperCase()} (estimated)`
      };
    } else if (fixedRates[reverseKey]) {
      const rate = 1 / fixedRates[reverseKey];
      const converted = (amount * rate).toFixed(2);
      return {
        success: true,
        result: `${amount} ${fromCurrency.toUpperCase()} = ${converted} ${toCurrency.toUpperCase()}`,
        rate: rate,
        details: `${getTranslation("exchangeRate")} 1 ${fromCurrency.toUpperCase()} = ${rate.toFixed(4)} ${toCurrency.toUpperCase()} (estimated)`
      };
    }
    
    return {
      success: false,
      error: getTranslation("exchangeError")
    };
  }
}

// ============ BOT RESPONSE ============
async function botResponse(msg) {
  const m = msg.toLowerCase().trim();
  
  // Get translations for current bot language
  function t(key) {
    return languageData[botLanguage]?.translations[key] || key;
  }
  
  // 1. Change language command
  if (m.includes("change language") || m.includes("cambia lingua") || m.includes("cambiar idioma") || 
      m.includes("changer la langue") || m.includes("sprache √§ndern") || m.includes("Êõ¥ÊîπËØ≠Ë®Ä") || 
      m.includes("ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸÑÿ∫ÿ©") || m.includes("–∏–∑–º–µ–Ω–∏—Ç—å —è–∑—ã–∫")) {
    
    const langMap = {
      'english': 'en', 'en': 'en',
      'italian': 'it', 'italiano': 'it', 'it': 'it',
      'spanish': 'es', 'espa√±ol': 'es', 'es': 'es',
      'french': 'fr', 'fran√ßais': 'fr', 'fr': 'fr',
      'german': 'de', 'deutsch': 'de', 'de': 'de',
      'chinese': 'zh', '‰∏≠Êñá': 'zh', 'zh': 'zh',
      'arabic': 'ar', 'ÿßŸÑÿπÿ±ÿ®Ÿäÿ©': 'ar', 'ar': 'ar',
      'russian': 'ru', '—Ä—É—Å—Å–∫–∏–π': 'ru', 'ru': 'ru'
    };
    
    for (const [keyword, langCode] of Object.entries(langMap)) {
      if (m.includes(keyword)) {
        changeLanguage(langCode);
        return `‚úÖ ${t('languageChanged') || 'Language changed to'} ${languageData[langCode].name}`;
      }
    }
    
    return `${t('availableLanguages') || 'Available languages'}: English, Italiano, Espa√±ol, Fran√ßais, Deutsch, ‰∏≠Êñá, ÿßŸÑÿπÿ±ÿ®Ÿäÿ©, –†—É—Å—Å–∫–∏–π`;
  }
  
  // 2. Currency conversion (FIXED - works correctly now)
  const currencyMatch = m.match(/(\d+(?:\.\d+)?)\s*(\w+)\s*(?:in|to|into|a|en|in)\s*(\w+)/i);
  if (currencyMatch) {
    const amount = parseFloat(currencyMatch[1]);
    const fromCurrency = currencyMatch[2];
    const toCurrency = currencyMatch[3];
    
    if (amount > 0) {
      const result = await getExchangeRate(fromCurrency, toCurrency, amount);
      if (result.success) {
        return `üí± ${t('currencyConversion') || 'Currency Conversion'}:\n${result.result}\n${result.details}`;
      } else {
        return `üí± ${t('error') || 'Error'}: ${result.error}\n${t('tryExample') || 'Try'}: '3 EUR in PKR' ${t('or') || 'or'} '100 USD in EUR'`;
      }
    }
  }
  
  // 3. Translation
  if (m.startsWith("translate ") || m.startsWith("traduci ") || m.includes(" to ") || m.includes(" in ")) {
    const patterns = [
      /translate\s+(.+?)\s+(?:to|in|into)\s+(\w+)/i,
      /traduci\s+(.+?)\s+(?:in|to|a)\s+(\w+)/i
    ];
    
    let textToTranslate = "";
    let targetLanguage = "en";
    
    for (const pattern of patterns) {
      const match = m.match(pattern);
      if (match) {
        textToTranslate = match[1].trim();
        if (match[2]) {
          targetLanguage = match[2].trim().toLowerCase();
        }
        break;
      }
    }
    
    if (!textToTranslate) {
      textToTranslate = m.replace(/translate|traduci|to|in|into|a/gi, '').trim();
    }
    
    if (textToTranslate.length > 1) {
      try {
        const langMap = {
          'english': 'en', 'en': 'en',
          'italian': 'it', 'italiano': 'it', 'it': 'it',
          'spanish': 'es', 'espa√±ol': 'es', 'es': 'es',
          'french': 'fr', 'fran√ßais': 'fr', 'fr': 'fr',
          'german': 'de', 'deutsch': 'de', 'de': 'de',
          'chinese': 'zh', '‰∏≠Êñá': 'zh', 'zh': 'zh',
          'arabic': 'ar', 'ÿßŸÑÿπÿ±ÿ®Ÿäÿ©': 'ar', 'ar': 'ar',
          'russian': 'ru', '—Ä—É—Å—Å–∫–∏–π': 'ru', 'ru': 'ru'
        };
        
        const targetLangCode = langMap[targetLanguage] || targetLanguage;
        
        const translation = await translateText(textToTranslate, targetLangCode);
        
        if (translation.success) {
          const langNames = {
            'en': 'English', 'it': 'Italian', 'es': 'Spanish', 'fr': 'French',
            'de': 'German', 'zh': 'Chinese', 'ar': 'Arabic', 'ru': 'Russian'
          };
          
          const targetLangName = langNames[targetLangCode] || targetLangCode;
          return `üåç ${t('translation') || 'Translation'}:\n${t('original') || 'Original'}: "${textToTranslate}"\n${targetLangName}: "${translation.translated}"`;
        } else {
          return `‚ö†Ô∏è ${t('translationError') || 'Could not translate'} "${textToTranslate}" ${t('to') || 'to'} ${targetLanguage}.`;
        }
      } catch (error) {
        return `‚ö†Ô∏è ${t('translationFailed') || 'Translation failed at the moment'}.`;
      }
    }
    
    return `üåç ${t('translationHelp') || 'Translation Help'}:\n${t('writeTranslate') || "Write 'translate [text] to [language]' to translate."}\n\n${t('examples') || 'Examples'}:\n‚Ä¢ 'translate hello to italian'\n‚Ä¢ 'translate ciao in english'\n‚Ä¢ 'traduci libro in spagnolo'\n‚Ä¢ 'traduci heft to english'`;
  }
  
  // 4. Math calculations
  if (m.startsWith("calculate ") || m.startsWith("calcola ") || m.startsWith("calcular ") || 
      /^[\d+\-*/().^œÄ√ó√∑ ]+$/.test(m) || m.includes("+") || m.includes("-") || m.includes("*") || m.includes("/")) {
    
    let expr = m;
    if (m.startsWith("calculate ")) expr = m.substring(10);
    else if (m.startsWith("calcola ")) expr = m.substring(8);
    else if (m.startsWith("calcular ")) expr = m.substring(9);
    
    if (expr.trim().length > 0) {
      try {
        const cleanExpr = expr
          .replace(/√ó/g, '*')
          .replace(/√∑/g, '/')
          .replace(/pi/gi, 'Math.PI')
          .replace(/\^/g, '**')
          .replace(/sqrt\(/gi, 'Math.sqrt(')
          .replace(/sin\(/gi, 'Math.sin(')
          .replace(/cos\(/gi, 'Math.cos(')
          .replace(/tan\(/gi, 'Math.tan(');
        
        const safeEval = new Function('return ' + cleanExpr);
        const result = safeEval();
        
        if (isNaN(result) || !isFinite(result)) {
          return t('calcError') || "I cannot calculate this expression.";
        }
        
        return `üßÆ ${t('calculation') || 'Calculation'}:\n${expr} = **${result}**`;
      } catch (error) {
        return t('calcFormatError') || "Calculation error. Please write the expression correctly.";
      }
    }
  }
  
  // 5. Simple responses based on language
  const greetings = {
    en: ["hello", "hi", "hey", "good morning", "good afternoon", "good evening"],
    it: ["ciao", "salve", "buongiorno", "buonasera"],
    es: ["hola", "buenos d√≠as", "buenas tardes"],
    fr: ["bonjour", "salut", "bonsoir"],
    de: ["hallo", "guten tag", "guten morgen"],
    zh: ["‰Ω†Â•Ω", "Âó®"],
    ar: ["ŸÖÿ±ÿ≠ÿ®ÿß", "ÿ£ŸáŸÑÿß"],
    ru: ["–ø—Ä–∏–≤–µ—Ç", "–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ"]
  };
  
  if (m.split(/\s+/).length <= 2) {
    const langGreetings = greetings[botLanguage] || greetings.en;
    for (const greeting of langGreetings) {
      if (m === greeting || m.startsWith(greeting + " ")) {
        return languageData[botLanguage].translations.botHello;
      }
    }
  }
  
  // 6. Default response
  const suggestions = {
    en: [
      "üí° **Try:** 'search information about...' for Wikipedia searches",
      "üåç **Translate:** 'translate hello to italian'",
      "üßÆ **Calculations:** 'calculate 2+2√ó3'",
      "üí± **Currency:** '3 EUR in PKR'",
      "üòÇ **Fun:** 'joke' for a laugh"
    ],
    it: [
      "üí° **Prova:** 'cerca informazioni su...' per ricerche Wikipedia",
      "üåç **Traduci:** 'traduci ciao in inglese'",
      "üßÆ **Calcoli:** 'calcola 2+2√ó3'",
      "üí± **Valuta:** '3 euro in pkr'",
      "üòÇ **Divertimento:** 'barzelletta'"
    ],
    es: [
      "üí° **Prueba:** 'busca informaci√≥n sobre...' para b√∫squedas en Wikipedia",
      "üåç **Traduce:** 'traduce hola al italiano'",
      "üßÆ **C√°lculos:** 'calcula 2+2√ó3'",
      "üí± **Moneda:** '3 euro en pkr'",
      "üòÇ **Diversi√≥n:** 'chiste'"
    ]
  };
  
  const langSuggestions = suggestions[botLanguage] || suggestions.en;
  return randomChoice(langSuggestions);
}

// Helper function to get translations
function getTranslation(key) {
  return languageData[botLanguage]?.translations[key] || key;
}

// ============ INITIALIZE APP ============
document.addEventListener('DOMContentLoaded', initApp);

// Close dropdown when clicking outside
document.addEventListener('click', (e) => {
  if (!e.target.closest('.language-selector')) {
    document.getElementById('languageDropdown').style.display = 'none';
  }
});
</script>
</body>
</html>
