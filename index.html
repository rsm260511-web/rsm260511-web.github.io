<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>RSM</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" type="image/png" href="rsm-header.png">
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&family=Playfair+Display:wght@500;700&display=swap" rel="stylesheet">
<style>
body{margin:0;font-family:'Montserrat',sans-serif;background:#0e0e11;color:#eaeaea;}
header{background:linear-gradient(rgba(0,0,0,.6),rgba(0,0,0,.9)),url('https://images.unsplash.com/photo-1500530855697-b586d89ba3ee');background-size:cover;background-position:center;padding:80px 20px;text-align:center;}
header h1{font-family:'Playfair Display',serif;font-size:52px;margin:0;}
nav{background:#15151c;padding:12px;display:flex;gap:15px;align-items:center;flex-wrap:wrap;}
nav a{cursor:pointer;font-weight:600;}
#searchBox{margin-left:auto;position:relative;}
#searchInput{padding:8px 10px;border-radius:20px;border:none;width:220px;}
#searchResults{position:absolute;top:38px;background:#1c1c25;width:100%;border-radius:10px;display:none;z-index:10;}
.search-item{padding:10px;cursor:pointer;}
.search-item:hover{background:#2a2a35;}
main{max-width:900px;margin:auto;padding:20px;}
.card{background:#1c1c25;padding:20px;border-radius:10px;margin-bottom:20px;}
.hidden{display:none}
#single img, #single iframe{max-width:100%;height:auto;object-fit:cover;border-radius:10px;margin:15px 0;}
#singleContent{line-height:1.7;}
#chatBox{display:none;position:fixed;bottom:20px;right:20px;width:350px;height:500px;background:#1c1c25;border-radius:10px;box-shadow:0 10px 25px rgba(0,0,0,0.4);overflow:hidden;flex-direction:column;z-index:1000;}
#chatMessages{flex-grow:1;padding:10px;overflow-y:auto;}
#chatInput{flex-grow:1;padding:10px;border:none;background:#0e0e11;color:#fff;outline:none;}
#chatSend{padding:0 15px;border:none;background:#ff4d4d;color:#fff;cursor:pointer;font-weight:600;}
</style>

<!-- Webpushr -->
<script>
(function(w,d,s,id){
  if(typeof(w.webpushr)!=='undefined') return;
  w.webpushr=w.webpushr||function(){
    (w.webpushr.q=w.webpushr.q||[]).push(arguments)
  };
  var js,fjs=d.getElementsByTagName(s)[0];
  js=d.createElement(s); js.id=id; js.async=1;
  js.src="https://cdn.webpushr.com/app.min.js";
  js.onload=function(){
    webpushr('setup',{
      'key':'BKdp3zSvl_w5aJH_c9naFADnGMJxh9khCwh0THm4hfU-PGhMZN8V5XpQt0nAqFULqVBjWSUk6lWblBhDYRbhWt4'
    });
  };
  fjs.parentNode.appendChild(js);
}(window,document,'script','webpushr-jssdk'));
</script>
</head>

<body>
<header>
  <h1>RSM</h1>
</header>

<nav>
  <a onclick="showSection('home')">Home</a>
  <a onclick="showSection('articles')">Articles</a>
  <a onclick="showSection('videos')">Videos</a>
  <a onclick="showSection('news')">News</a>
  <a onclick="showSection('categories')">Categories</a>
  <a onclick="showSection('about')">About Us</a>
  <a onclick="showSection('contacts')">Contacts</a>

  <div id="searchBox">
    <input id="searchInput" placeholder="Search..." oninput="searchAll()">
    <div id="searchResults"></div>
  </div>

 <!-- Chatbot AI -->
<div id="chatBotContainer" style="position:relative; margin-left:15px;">
  <button id="chatToggle" style="padding:8px 12px; border:none; border-radius:20px; background:#ff4d4d; color:#fff; cursor:pointer; font-weight:600;">
    AI Chat
  </button>
  
  <div id="chatBox" style="display:none; position:fixed; bottom:20px; right:20px; width:350px; height:500px; background:#1c1c25; border-radius:10px; box-shadow:0 10px 25px rgba(0,0,0,0.4); overflow:hidden; flex-direction:column; z-index:1000;">
    
    <div style="background:#15151c; padding:12px 15px; display:flex; align-items:center; border-bottom:1px solid #333;">
      <button id="chatClose" style="background:#ff4d4d; color:white; border:none; width:30px; height:30px; border-radius:50%; cursor:pointer; display:flex; align-items:center; justify-content:center; font-weight:bold; margin-right:10px;">
        √ó
      </button>
      <span style="color:#fff; font-weight:600;">ü§ñ RSM Assistant</span>
    </div>
    
    <div id="chatMessages" style="flex:1; overflow-y:auto; padding:15px;"></div>
    
    <div style="border-top:1px solid #333; padding:12px; background:#15151c;">
      <div style="display:flex; gap:8px;">
        <input id="chatInput" type="text" placeholder="Type here..." autocomplete="off" 
               style="flex:1; padding:10px; background:#0e0e11; color:#fff; border:none; border-radius:6px; outline:none;">
        <button id="chatSend" style="padding:0 15px; background:#4da6ff; color:#fff; border:none; border-radius:6px; cursor:pointer; font-weight:600;">
          Send
        </button>
      </div>
    </div>
  </div>
</div>
</nav>

<main>
<section id="home">
  <div id="latestNews" class="card" style="border-left:5px solid #ff4d4d">
    <h2>üü• Latest News</h2>
    <h3 id="latestTitle"></h3>
    <p style="opacity:.7">Click to read the full news</p>
  </div>
  <div id="latestVideo" class="card" style="border-left:5px solid #4da6ff">
    <h2>üé¨ Latest Video</h2>
    <h3 id="latestVideoTitle"></h3>
    <p style="opacity:.7">Click to watch the full video</p>
  </div>
</section>

<section id="articles" class="hidden"></section>
<section id="videos" class="hidden"></section>
<section id="news" class="hidden"></section>
<section id="categories" class="hidden"></section>

<section id="about" class="hidden">
  <div class="card">
    <h2>About Us</h2>
    <p id="publicDescription"></p>
  </div>
</section>

<section id="contacts" class="hidden">
  <div class="card">
    <h2>Contacts</h2>
    <p>üìû +39 351 093 3272</p>
    <p>üìß rsm260511@gmail.com</p>
  </div>
</section>

<section id="single" class="hidden card">
  <h2 id="singleTitle"></h2>
  <p id="singleDate" style="opacity:.6;font-size:14px;margin-top:-10px"></p>
  <div id="singleImage"></div>
  <div id="singleContent"></div>
</section>
</main>

<footer style="text-align:center;padding:20px;font-size:14px;opacity:.6">
¬© 2025 ‚Äì RSM | All rights reserved
</footer>
<script>
// DATA
let articles=[];
fetch('https://raw.githubusercontent.com/rsm260511-web/RSM/main/data.json')
.then(r=>r.json())
.then(data=>{
  document.getElementById('publicDescription').innerText=data.description;
  articles = data.articles;
  renderArticles();
  renderVideos();
  renderNews();
  renderCategories();
  renderLatestNews();
  renderLatestVideo();
});

// SECTIONS
function showSection(id){
  document.querySelectorAll('main section').forEach(s=>s.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
  window.scrollTo(0,0);
}

// RENDER ARTICLES, VIDEOS, NEWS, CATEGORIES
function renderArticles() {
    const c = document.getElementById('articles');
    c.innerHTML = '';
    articles.filter(a => a.type === "article").forEach(a => {
        const i = articles.indexOf(a);
        const d = document.createElement('div');
        d.className = 'card';
        d.innerHTML = `<h2>${a.title}</h2>`;
        d.onclick = () => openArticle(i);
        c.appendChild(d);
    });
}

function renderVideos() {
    const c = document.getElementById('videos');
    c.innerHTML = '';
    articles.filter(a => a.type === "video").forEach(a => {
        const i = articles.indexOf(a);
        const d = document.createElement('div');
        d.className = 'card';
        d.innerHTML = `<h2>${a.title}</h2>`;
        d.onclick = () => openVideo(i);
        c.appendChild(d);
    });
}

function renderNews() {
    const c = document.getElementById('news');
    c.innerHTML = '';
    articles.filter(a => a.type === "news").forEach(a => {
        const i = articles.indexOf(a);
        const d = document.createElement('div');
        d.className = 'card';
        d.innerHTML = `<h2>${a.title}</h2>`;
        d.onclick = () => openArticle(i);
        c.appendChild(d);
    });
}

function renderCategories() {
    const c = document.getElementById('categories');
    c.innerHTML = '';
    [...new Set(articles.map(a => a.category))].forEach(cat => {
        const box = document.createElement('div');
        box.className = 'card';
        box.innerHTML = `<h2>${cat}</h2>`;
        articles.filter(a => a.category === cat).forEach(a => {
            const i = articles.indexOf(a);
            const p = document.createElement('p');
            p.style.cursor = 'pointer';
            p.innerText = "‚Ä¢ " + a.title;
            p.onclick = () => {
                if (a.type === "video") {
                    openVideo(i);
                } else {
                    openArticle(i);
                }
            };
            box.appendChild(p);
        });
        c.appendChild(box);
    });
  }

// OPEN ARTICLES/VIDEOS - LARGER VIDEO
function openArticle(i){
  const a=articles[i]; 
  showSection('single'); 
  document.getElementById('singleTitle').innerText=a.title; 
  document.getElementById('singleDate').innerText=a.date?("üìÖ Published on "+new Date(a.date).toLocaleDateString('en-US')):""; 
  const imgBox=document.getElementById('singleImage'); 
  imgBox.innerHTML=''; 
  if(a.images && Array.isArray(a.images)){ 
    a.images.forEach(src=>{
      const img=document.createElement('img'); 
      img.src=src;
      imgBox.appendChild(img);
    }); 
  } else if(a.image){
    imgBox.innerHTML=`<img src="${a.image}">`; 
  } 
  document.getElementById('singleContent').innerHTML=`<p>${a.content.replace(/\n/g,"<br><br>")}</p>`;
}

function openVideo(i){
  const a=articles[i]; 
  showSection('single'); 
  document.getElementById('singleTitle').innerText=a.title; 
  document.getElementById('singleDate').innerText=a.date?("üìÖ Published on "+new Date(a.date).toLocaleDateString('en-US')):""; 
  const imgBox=document.getElementById('singleImage'); 
  imgBox.innerHTML=''; 
  
  if(a.videoUrl){ 
    // LARGER VIDEO
    imgBox.innerHTML=`
      <div style="width:100%; max-width:100%; margin:20px 0;">
        <iframe width="100%" height="200" src="${a.videoUrl}" 
                frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                allowfullscreen style="border-radius:10px;">
        </iframe>
      </div>
    `;
  } else if(a.images && Array.isArray(a.images)){ 
    a.images.forEach(src=>{
      const img=document.createElement('img'); 
      img.src=src;
      imgBox.appendChild(img);
    }); 
  } 
  document.getElementById('singleContent').innerHTML=`<p>${a.content.replace(/\n/g,"<br><br>")}</p>`;
}

// SEARCH
function searchAll(){
  const q=searchInput.value.toLowerCase(); 
  const box=searchResults; 
  box.innerHTML=''; 
  if(!q){
    box.style.display='none'; 
    return;
  } 
  articles.forEach((a,i)=>{
    if(a.title.toLowerCase().includes(q) || a.content.toLowerCase().includes(q)){
      const d=document.createElement('div'); 
      d.className='search-item'; 
      d.innerText=a.title; 
      d.onclick=()=>{
        if (a.type === "video") {
          openVideo(i);
        } else {
          openArticle(i);
        }
      }; 
      box.appendChild(d);
    }
  }); 
  box.style.display=box.children.length?'block':'none';
}

// LATEST NEWS & VIDEO
function renderLatestNews(){
  const news=articles.filter(a=>a.type==="news").sort((a,b)=>new Date(b.date)-new Date(a.date))[0]; 
  if(!news) return; 
  document.getElementById('latestTitle').innerText=news.title; 
  const i=articles.findIndex(a=>a.title===news.title); 
  document.getElementById('latestNews').onclick=()=>openArticle(i);
}

function renderLatestVideo(){
  const video=articles.filter(a=>a.type==="video").sort((a,b)=>new Date(b.date)-new Date(a.date))[0]; 
  if(!video) return; 
  document.getElementById('latestVideoTitle').innerText=video.title; 
  const i=articles.findIndex(a=>a.title===video.title); 
  document.getElementById('latestVideo').onclick=()=>openVideo(i);
}

// ============ CHATBOT AI ============
const chatToggle = document.getElementById('chatToggle');
const chatBox = document.getElementById('chatBox');
const chatMessages = document.getElementById('chatMessages');
const chatInput = document.getElementById('chatInput');
const chatSend = document.getElementById('chatSend');

let lastQuestion = null;

// Open/Close chat
chatToggle.addEventListener('click', () => {
  chatBox.style.display = chatBox.style.display === 'flex' ? 'none' : 'flex';
  if (chatBox.style.display === 'flex') chatInput.focus();
});

const chatClose = document.getElementById('chatClose');
chatClose.addEventListener('click', () => {
  chatBox.style.display = 'none';
});

// Add message
function appendMessage(sender, text) {
  const div = document.createElement('div');
  div.innerHTML = text.replace(/\n/g, '<br>');
  div.style.margin = '5px';
  div.style.padding = '8px 12px';
  div.style.borderRadius = '15px';
  div.style.maxWidth = '80%';
  div.style.wordWrap = 'break-word';
  div.style.alignSelf = sender === 'user' ? 'flex-end' : 'flex-start';
  div.style.background = sender === 'user' ? '#007bff' : '#333';
  div.style.color = '#fff';
  chatMessages.appendChild(div);
  chatMessages.scrollTop = chatMessages.scrollHeight;
}

// Send message ASYNC
async function sendMessage() {
  const msg = chatInput.value.trim();
  if (!msg) return;
  
  appendMessage('user', msg);
  
  // AI Response
  const botReply = await botResponse(msg);
  appendMessage('bot', botReply);
  
  chatInput.value = '';
  chatInput.focus();
}

chatSend.addEventListener('click', sendMessage);
chatInput.addEventListener('keypress', e => {
  if (e.key === 'Enter') sendMessage();
});

function randomChoice(arr) {
  return arr[Math.floor(Math.random() * arr.length)];
}

// ============ WIKIPEDIA SEARCH (ENGLISH) ============
async function wikipediaSearch(query) {
  try {
    const searchUrl = `https://en.wikipedia.org/w/api.php?action=query&list=search&srsearch=${encodeURIComponent(query)}&format=json&origin=*&srlimit=1`;
    
    const searchResponse = await fetch(searchUrl);
    const searchData = await searchResponse.json();
    
    if (!searchData.query?.search?.length) {
      return "üîç I couldn't find information on this topic.";
    }
    
    const pageTitle = searchData.query.search[0].title;
    const contentUrl = `https://en.wikipedia.org/w/api.php?action=query&prop=extracts&exintro=true&explaintext=true&titles=${encodeURIComponent(pageTitle)}&format=json&origin=*`;
    
    const contentResponse = await fetch(contentUrl);
    const contentData = await contentResponse.json();
    
    const pages = contentData.query.pages;
    const pageId = Object.keys(pages)[0];
    
    if (pageId === "-1" || !pages[pageId].extract) {
      return `üìö **${pageTitle}**\n\nLimited information on this topic.`;
    }
    
    const extract = pages[pageId].extract;
    const shortExtract = extract.length > 400 ? extract.substring(0, 400) + "..." : extract;
    
    return `üìö **${pageTitle}**\n\n${shortExtract}`;
    
  } catch (error) {
    return "‚ö†Ô∏è Unable to perform search at this moment.";
  }
}

// ============ TEXT SUMMARIZATION ============
function summarizeText(text, maxSentences = 3) {
  if (!text) return "There's no text to summarize.";
  
  text = text.replace(/<[^>]*>/g, ' ').replace(/\s+/g, ' ').trim();
  const sentences = text.split(/[.!?]+/).filter(s => s.trim().length > 0);
  
  if (sentences.length <= maxSentences) {
    return sentences.join('. ') + '.';
  }
  
  const words = text.toLowerCase().split(/\s+/).filter(w => w.length > 3);
  const wordFreq = {};
  words.forEach(w => wordFreq[w] = (wordFreq[w] || 0) + 1);
  
  const scoredSentences = sentences.map(sentence => {
    const sentenceWords = sentence.toLowerCase().split(/\s+/);
    let score = 0;
    sentenceWords.forEach(w => {
      if (wordFreq[w]) score += wordFreq[w];
    });
    return { sentence: sentence.trim(), score: score / sentenceWords.length };
  });
  
  scoredSentences.sort((a, b) => b.score - a.score);
  const bestSentences = scoredSentences.slice(0, maxSentences);
  bestSentences.sort((a, b) => sentences.indexOf(a.sentence) - sentences.indexOf(b.sentence));
  
  return bestSentences.map(s => s.sentence).join('. ') + '.';
}

// Find article by title
function findArticleByTitle(title) {
  const searchTitle = title.toLowerCase().trim();
  return articles.find(a => 
    a.title.toLowerCase().includes(searchTitle) || 
    searchTitle.includes(a.title.toLowerCase())
  );
}

// ============ MATH CALCULATION ============
function calculateMathExpression(expr) {
  try {
    // Replace "√ó" with "*", "√∑" with "/" and "pi" with Math.PI
    const cleanExpr = expr
      .replace(/√ó/g, '*')
      .replace(/√∑/g, '/')
      .replace(/pi/gi, 'Math.PI')
      .replace(/\^/g, '**')
      .replace(/sqrt\(/gi, 'Math.sqrt(')
      .replace(/sin\(/gi, 'Math.sin(')
      .replace(/cos\(/gi, 'Math.cos(')
      .replace(/tan\(/gi, 'Math.tan(')
      .replace(/log\(/gi, 'Math.log10(')
      .replace(/ln\(/gi, 'Math.log(');
    
    // Use eval only for safe mathematical expressions
    const safeEval = new Function('return ' + cleanExpr);
    const result = safeEval();
    
    if (isNaN(result) || !isFinite(result)) {
      return "I cannot calculate this expression.";
    }
    
    return result.toString();
  } catch (error) {
    return "Calculation error. Please write the expression correctly.";
  }
}

// ============ TRANSLATION API (MULTI-LANGUAGE) ============
async function translateText(text, targetLang = 'en') {
  try {
    // Language code mapping
    const langCodes = {
      'english': 'en', 'en': 'en',
      'italian': 'it', 'it': 'it',
      'spanish': 'es', 'es': 'es',
      'french': 'fr', 'fr': 'fr',
      'german': 'de', 'de': 'de',
      'portuguese': 'pt', 'pt': 'pt',
      'russian': 'ru', 'ru': 'ru',
      'arabic': 'ar', 'ar': 'ar',
      'chinese': 'zh', 'zh': 'zh',
      'japanese': 'ja', 'ja': 'ja',
      'korean': 'ko', 'ko': 'ko',
      'hindi': 'hi', 'hi': 'hi',
      'dutch': 'nl', 'nl': 'nl',
      'polish': 'pl', 'pl': 'pl',
      'turkish': 'tr', 'tr': 'tr',
      'greek': 'el', 'el': 'el',
      'swedish': 'sv', 'sv': 'sv'
    };
    
    // Normalize target language
    const targetLangCode = langCodes[targetLang.toLowerCase()] || targetLang;
    
    // Use LibreTranslate API (free and reliable)
    const response = await fetch('https://libretranslate.com/translate', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        q: text,
        source: 'auto',
        target: targetLangCode,
        format: 'text'
      })
    });
    
    const data = await response.json();
    
    if (data.translatedText) {
      return {
        translated: data.translatedText,
        detectedLanguage: data.detectedLanguage?.language || 'unknown'
      };
    }
    
    throw new Error("Translation failed");
    
  } catch (error) {
    // Fallback to MyMemory API
    try {
      const response = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=auto|${targetLang}`);
      const data = await response.json();
      
      if (data.responseData && data.responseData.translatedText) {
        return {
          translated: data.responseData.translatedText,
          detectedLanguage: 'auto'
        };
      }
    } catch {
      return {
        translated: text,
        detectedLanguage: 'unknown',
        error: true
      };
    }
  }
}

// ============ CURRENCY EXCHANGE API ============
async function getExchangeRate(fromCurrency, toCurrency, amount = 1) {
  try {
    // Use ExchangeRate-API with fallback
    const response = await fetch(`https://api.exchangerate-api.com/v4/latest/${fromCurrency.toUpperCase()}`);
    const data = await response.json();
    
    if (data.rates && data.rates[toCurrency.toUpperCase()]) {
      const rate = data.rates[toCurrency.toUpperCase()];
      const converted = (amount * rate).toFixed(2);
      return {
        success: true,
        result: `${amount} ${fromCurrency.toUpperCase()} = ${converted} ${toCurrency.toUpperCase()}`,
        rate: rate,
        details: `Exchange rate: 1 ${fromCurrency.toUpperCase()} = ${rate.toFixed(4)} ${toCurrency.toUpperCase()}`
      };
    } else {
      return {
        success: false,
        error: "Currency not supported"
      };
    }
  } catch (error) {
    try {
      // Fallback API
      const response = await fetch(`https://open.er-api.com/v6/latest/${fromCurrency.toUpperCase()}`);
      const data = await response.json();
      
      if (data.rates && data.rates[toCurrency.toUpperCase()]) {
        const rate = data.rates[toCurrency.toUpperCase()];
        const converted = (amount * rate).toFixed(2);
        return {
          success: true,
          result: `${amount} ${fromCurrency.toUpperCase()} = ${converted} ${toCurrency.toUpperCase()}`,
          rate: rate,
          details: `Exchange rate: 1 ${fromCurrency.toUpperCase()} = ${rate.toFixed(4)} ${toCurrency.toUpperCase()}`
        };
      }
    } catch {
      return {
        success: false,
        error: "Unable to retrieve exchange rate"
      };
    }
  }
}

// ============ JOKES FROM API ============
async function getJokeFromAPI() {
  try {
    // JokeAPI
    const res = await fetch('https://v2.jokeapi.dev/joke/Any?safe-mode&' + Date.now());
    const data = await res.json();
    
    if (data.error) {
      throw new Error("API error");
    }
    
    if (data.type === 'single') {
      return `üòÇ **Joke:**\n${data.joke}`;
    } else if (data.type === 'twopart') {
      return `üòÇ **Joke:**\n${data.setup}\n\n${data.delivery}`;
    }
    
    throw new Error("Unsupported format");
  } catch (error) {
    // Fallback to another API
    try {
      const res = await fetch('https://official-joke-api.appspot.com/random_joke');
      const data = await res.json();
      return `üòÇ **Joke:**\n${data.setup}\n\n${data.punchline}`;
    } catch {
      return "üòÇ **Joke:**\nWhy don't scientists trust atoms? Because they make up everything.";
    }
  }
}

// ============ ADVICE FROM API ============
async function getAdviceFromAPI() {
  try {
    const res = await fetch('https://api.adviceslip.com/advice?' + Date.now());
    const data = await res.json();
    
    if (data.slip && data.slip.advice) {
      return `üí° **Advice:**\n${data.slip.advice}`;
    }
    
    throw new Error("No advice found");
  } catch (error) {
    // Fallback to predefined advice
    const adviceList = [
      "üí° **Advice:**\nDon't put off until tomorrow what you can do today.",
      "üí° **Advice:**\nThe best preparation for the future is to live well in the present.",
      "üí° **Advice:**\nSmall daily habits create big results over time.",
      "üí° **Advice:**\nListen before you speak. Understanding comes from attentive listening.",
      "üí° **Advice:**\nTake care of your mental health as much as your physical health."
    ];
    
    return adviceList[Math.floor(Math.random() * adviceList.length)];
  }
}

// ============ INTELLIGENT COMMANDS SYSTEM ============
const intelligentCommands = {
  "what's your name": "ü§ñ My name is **RSM Assistant**! I'm the AI assistant of RSM website.",
  "your name": "ü§ñ My name is **RSM Assistant**! Created to help you.",
  "what is your name": "ü§ñ My name is **RSM Assistant**!",
  "do you have a name": "ü§ñ Yes! My name is **RSM Assistant**.",
  
  "what are you": "‚ö° I am an **advanced AI assistant** integrated into the RSM website.",
  "who are you": "‚ö° I am **RSM Assistant**, your personal AI helper!",
  "are you an ai": "‚úÖ Exactly! I am an **intelligent AI** created to assist you.",
  
  "what can you do": "‚ú® **I can:**\n‚Ä¢ üîç Search information on Wikipedia\n‚Ä¢ üìù Summarize articles and texts\n‚Ä¢ üó∫Ô∏è Guide you through Articles/Videos/News\n‚Ä¢ üí¨ Answer your questions\n‚Ä¢ üåç Translate between any languages\n‚Ä¢ üßÆ Perform mathematical calculations\n‚Ä¢ üí± Convert any currency\n‚Ä¢ üòÇ Tell jokes (from API)\n‚Ä¢ üí° Give advice\n‚Ä¢ üìä Provide real-time exchange rates",
  
  "who created you": "üë®‚Äçüíª I was developed by the **RSM team** to provide intelligent assistance.",
  "creator": "üë®‚Äçüíª My creator is the **RSM team**.",
  
  "thank you": "üôè **You're welcome!** Happy to help! üòä",
  "thanks": "üôè **You're welcome!** üòä",
  
  "goodbye": "üëã **Goodbye!** Come back anytime!",
  "bye": "üëã **See you!** I'll be here if you need me.",
  
  "help": "üÜò **Here's what I can do:**\n‚Ä¢ 'search [topic]' - Wikipedia searches\n‚Ä¢ 'summarize' - article summaries\n‚Ä¢ 'articles/videos/news' - site navigation\n‚Ä¢ 'translate [text] to [language]' - translations\n‚Ä¢ 'calculate [expression]' - mathematical calculations\n‚Ä¢ 'exchange [currency] [currency]' - currency conversion\n‚Ä¢ '3 euro in pkr' - direct conversions\n‚Ä¢ 'joke' - jokes from API\n‚Ä¢ 'advice' - advice in English\n‚Ä¢ 'quote' - famous quotes",
  
  // SPECIAL COMMANDS THAT TRIGGER ACTIONS
  "summarize": "SUMMARY",
  "summary": "SUMMARY",
  
  "search": "SEARCH",
  "find": "SEARCH", 
  "look for": "SEARCH",
  
  "what is": "WHATIS",
  "what's": "WHATIS",
  "who is": "WHOIS",
  
  "calculate": "CALCULATE",
  "calculation": "CALCULATE",
  "how much is": "CALCULATE"
};

// ============ INTELLIGENT BOT RESPONSE ============
async function botResponse(msg) {
  const m = msg.toLowerCase().trim();
  
  // 1. GREETINGS
  const greetings = ["hello", "hi", "hey", "good morning", "good afternoon", "good evening"];
  
  if (m.split(/\s+/).length <= 2) {
    for (const greeting of greetings) {
      if (m === greeting || m.startsWith(greeting + " ")) {
        return "üëã Hello! I'm RSM Assistant. I can search information, summarize articles, translate between languages, perform calculations, convert currencies, tell jokes, and give advice!";
      }
    }
  }
  
  // 2. TRANSLATION (Advanced multi-language)
  if (m.startsWith("translate ") || m.startsWith("traduci ") || m.includes(" to ") || m.includes(" in ")) {
    // Match patterns like:
    // "translate hello to italian"
    // "translate ciao in english"
    // "traduci libro in spagnolo"
    // "traduci heft to english"
    
    const translatePatterns = [
      /translate\s+(.+?)\s+(?:to|in|into)\s+(\w+)/i,
      /traduci\s+(.+?)\s+(?:in|to|a)\s+(\w+)/i,
      /translate\s+(.+)/i,
      /traduci\s+(.+)/i
    ];
    
    let textToTranslate = "";
    let targetLanguage = "english";
    
    for (const pattern of translatePatterns) {
      const match = m.match(pattern);
      if (match) {
        textToTranslate = match[1].trim();
        if (match[2]) {
          targetLanguage = match[2].trim();
        }
        break;
      }
    }
    
    // Common language mappings
    const languageMap = {
      'english': 'en', 'eng': 'en', 'en': 'en',
      'italian': 'it', 'italiano': 'it', 'it': 'it',
      'spanish': 'es', 'espa√±ol': 'es', 'spagnolo': 'es', 'es': 'es',
      'french': 'fr', 'fran√ßais': 'fr', 'francese': 'fr', 'fr': 'fr',
      'german': 'de', 'deutsch': 'de', 'tedesco': 'de', 'de': 'de',
      'portuguese': 'pt', 'portugu√™s': 'pt', 'portoghese': 'pt', 'pt': 'pt',
      'russian': 'ru', '—Ä—É—Å—Å–∫–∏–π': 'ru', 'russo': 'ru', 'ru': 'ru',
      'arabic': 'ar', 'ÿπÿ±ÿ®Ÿä': 'ar', 'arabo': 'ar', 'ar': 'ar',
      'chinese': 'zh', '‰∏≠Êñá': 'zh', 'cinese': 'zh', 'zh': 'zh',
      'japanese': 'ja', 'Êó•Êú¨Ë™û': 'ja', 'giapponese': 'ja', 'ja': 'ja',
      'korean': 'ko', 'ÌïúÍµ≠Ïñ¥': 'ko', 'coreano': 'ko', 'ko': 'ko',
      'hindi': 'hi', '‡§π‡§ø‡§®‡•ç‡§¶‡•Ä': 'hi', 'hindi': 'hi', 'hi': 'hi'
    };
    
    const normalizedTargetLang = languageMap[targetLanguage.toLowerCase()] || targetLanguage;
    
    if (textToTranslate.length > 1) {
      try {
        const translation = await translateText(textToTranslate, normalizedTargetLang);
        
        if (!translation.error && translation.translated !== textToTranslate) {
          // Get language name for display
          const langNames = {
            'en': 'English', 'it': 'Italian', 'es': 'Spanish', 'fr': 'French',
            'de': 'German', 'pt': 'Portuguese', 'ru': 'Russian', 'ar': 'Arabic',
            'zh': 'Chinese', 'ja': 'Japanese', 'ko': 'Korean', 'hi': 'Hindi'
          };
          
          const targetLangName = langNames[normalizedTargetLang] || normalizedTargetLang;
          return `üåç **Translation:**\nOriginal: "${textToTranslate}"\n${targetLangName}: "${translation.translated}"`;
        } else {
          return `‚ö†Ô∏è Could not translate "${textToTranslate}" to ${targetLanguage}. Please try with a different text.`;
        }
      } catch (error) {
        return "‚ö†Ô∏è Unable to translate at this moment. Please try again later.";
      }
    }
    
    return `üåç **Translation Help:**\nWrite 'translate [text] to [language]' to translate.\n\n**Examples:**\n‚Ä¢ 'translate hello to italian'\n‚Ä¢ 'translate ciao in english'\n‚Ä¢ 'traduci libro in spagnolo'\n‚Ä¢ 'traduci heft to english'\n\n**Supported languages:** English, Italian, Spanish, French, German, Portuguese, Russian, Arabic, Chinese, Japanese, Korean, Hindi`;
  }
  
  // 3. MATH CALCULATIONS
  if (m.startsWith("calculate ") || m.startsWith("how much is ") || 
      m.startsWith("what is ") || /^[\d+\-*/().^œÄ√ó√∑ ]+$/.test(m) || 
      m.includes("+") || m.includes("-") || m.includes("*") || m.includes("/")) {
    
    let expr = m;
    if (m.startsWith("calculate ")) expr = m.substring(10);
    else if (m.startsWith("how much is ")) expr = m.substring(12);
    else if (m.startsWith("what is ")) expr = m.substring(8);
    
    if (expr.trim().length > 0) {
      const result = calculateMathExpression(expr);
      return `üßÆ **Calculation:**\n${expr} = **${result}**`;
    }
  }
  
  // 4. CURRENCY CONVERSION (direct)
  const currencyRegex = /(\d+(?:\.\d+)?)\s+(\w{3})\s+(?:in|to|into)\s+(\w{3})/i;
  const currencyMatch = m.match(currencyRegex);
  
  if (currencyMatch) {
    const amount = parseFloat(currencyMatch[1]);
    const fromCurrency = currencyMatch[2].toUpperCase();
    const toCurrency = currencyMatch[3].toUpperCase();
    
    if (amount > 0) {
      const result = await getExchangeRate(fromCurrency, toCurrency, amount);
      if (result.success) {
        return `üí± **Currency Conversion:**\n${result.result}\n${result.details}`;
      } else {
        return `üí± **Error:** ${result.error}\nTry: '3 EUR in PKR' or '100 USD in EUR'`;
      }
    }
  }
  
  // 5. CURRENCY EXCHANGE (list rates)
  if (m.includes("exchange") || m.includes("currency") || m.includes("rate") || 
      m.includes("euro in") || m.includes("usd in") || m.includes("pkr in")) {
    try {
      const res = await fetch('https://api.exchangerate-api.com/v4/latest/USD');
      const data = await res.json();
      
      let response = "üí± **Exchange Rates (USD base):**\n";
      const currencies = ['EUR', 'GBP', 'PKR', 'JPY', 'CNY', 'INR', 'CAD', 'AUD', 'CHF', 'AED'];
      
      currencies.forEach(curr => {
        if (data.rates[curr]) {
          response += `‚Ä¢ 1 USD = ${data.rates[curr].toFixed(4)} ${curr}\n`;
        }
      });
      
      response += "\n**To convert:** '[amount] [currency1] in [currency2]'\n**Examples:**\n‚Ä¢ '3 EUR in PKR'\n‚Ä¢ '100 USD in EUR'\n‚Ä¢ '50 GBP in USD'";
      return response;
    } catch {
      return "üí± **Exchange Rates (estimates):**\n‚Ä¢ 1 USD ‚âà 0.92 EUR\n‚Ä¢ 1 USD ‚âà 0.79 GBP\n‚Ä¢ 1 USD ‚âà 278.50 PKR\n‚Ä¢ 1 USD ‚âà 110.00 JPY\n‚Ä¢ 1 EUR ‚âà 299.50 PKR\n\n**Examples:** '3 euro in pkr' or '100 usd in eur'";
    }
  }
  
  // 6. JOKES FROM API
  if (m.includes("joke") || m.includes("funny") || m.includes("humor") || m.includes("laugh")) {
    try {
      const joke = await getJokeFromAPI();
      return joke;
    } catch (error) {
      return "üòÇ **Joke:**\nWhy don't scientists trust atoms? Because they make up everything.";
    }
  }
  
  // 7. ADVICE FROM API
  if (m.includes("advice") || m.includes("suggestion") || m.includes("tip")) {
    try {
      const advice = await getAdviceFromAPI();
      return advice;
    } catch (error) {
      return "üí° **Advice:**\nDon't put off until tomorrow what you can do today.";
    }
  }
  
  // 8. INTELLIGENT COMMANDS SYSTEM
  for (const [command, response] of Object.entries(intelligentCommands)) {
    if (m.includes(command)) {
      if (response === "SUMMARY") {
        if (!document.getElementById('single').classList.contains('hidden')) {
          const articleContent = document.getElementById('singleContent').innerText;
          if (articleContent) {
            const summary = summarizeText(articleContent);
            return `üìù **Summary:**\n\n${summary}`;
          }
        }
        return "To summarize an article, first open the article or write 'summarize [article title]'.";
      }
      
      if (response === "SEARCH" || response === "WHATIS" || response === "WHOIS") {
        let searchQuery = m.replace(command, '').trim();
        searchQuery = searchQuery.replace(/[?.,!;:]/g, '').trim();
        
        if (searchQuery.length > 2) {
          return await wikipediaSearch(searchQuery);
        }
        return "What do you want me to search? Write 'search [topic]' for a search.";
      }
      
      if (response === "CALCULATE") {
        let expr = m.replace(command, '').trim();
        if (expr.length > 0) {
          const result = calculateMathExpression(expr);
          return `üßÆ **Calculation:**\n${expr} = **${result}**`;
        }
        return "Write 'calculate [expression]' to calculate.\nExamples:\n‚Ä¢ 'calculate 2+2√ó3'\n‚Ä¢ 'calculate sin(30)'\n‚Ä¢ 'calculate sqrt(16)'";
      }
      
      return response;
    }
  }
  
  // 9. SITE NAVIGATION
  const navigation = {
    "articles": {section: 'articles', emoji: 'üìÑ'},
    "videos": {section: 'videos', emoji: 'üé¨'},
    "news": {section: 'news', emoji: 'üì∞'},
    "categories": {section: 'categories', emoji: 'üè∑Ô∏è'},
    "about": {section: 'about', emoji: 'üë•'},
    "contacts": {section: 'contacts', emoji: 'üìû'},
    "home": {section: 'home', emoji: 'üè†'}
  };
  
  for (const [keyword, info] of Object.entries(navigation)) {
    if (m.includes(keyword)) {
      lastQuestion = `Do you want to open the ${keyword} section?`;
      return `${info.emoji} ${lastQuestion}\n\nSay **'Yes'** to confirm or **'No'** to cancel.`;
    }
  }
  
  // 10. YES/NO HANDLING
  if (lastQuestion) {
    if (m.includes("yes") || m.includes("yeah") || m === "y" || m === "ok") {
      const question = lastQuestion;
      lastQuestion = null;
      
      for (const [keyword, info] of Object.entries(navigation)) {
        if (question.includes(keyword)) {
          showSection(info.section);
          return `‚úÖ ${info.emoji} **${keyword} section opened!**`;
        }
      }
    }
    
    if (m.includes("no") || m.includes("not") || m.includes("nope") || m === "n") {
      lastQuestion = null;
      return "üëå Okay, operation cancelled.";
    }
  }
  
  // 11. AUTOMATIC SEARCH IF LONG QUESTION
  if (m.includes("?") && m.length > 10) {
    let searchQuery = m.replace(/[?.,!]/g, '').trim();
    if (searchQuery.length > 5) {
      return await wikipediaSearch(searchQuery);
    }
  }
  
  // 12. QUOTES - REAL API
  if (m.includes("quote") || m.includes("famous quotes") || m.includes("quotes")) {
    try {
      const res = await fetch('https://api.quotable.io/random?' + Date.now());
      const data = await res.json();
      return `üí¨ **Quote:**\n"${data.content}"\n\n‚Äî ${data.author}`;
    } catch {
      return "‚ö†Ô∏è Unable to retrieve a quote at the moment.";
    }
  }
  
  // 13. INTELLIGENT RESPONSES
  if (m.includes("?")) {
    return "ü§î That's an interesting question! Try asking me 'search [topic]' for a detailed answer from Wikipedia.";
  }
  
  // 14. SUGGESTIONS
  const suggestions = [
    "üí° **Try:** 'search information about...' for Wikipedia searches",
    "üåç **Translate:** 'translate hello to italian' or 'traduci ciao in english'",
    "üßÆ **Calculations:** 'calculate 2+2√ó3' or 'how much is sin(30)'",
    "üí± **Currency:** '3 EUR in PKR' or '100 USD in EUR'",
    "üòÇ **Fun:** 'joke' for a laugh",
    "üí° **Help:** 'advice' for some advice",
    "üîç **Type:** 'help' to see everything I can do"
  ];
  
  return randomChoice(suggestions);
}
</script>
</body>
</html>
