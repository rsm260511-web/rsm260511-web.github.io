<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>RSM</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" type="image/png" href="rsm-header.png">
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&family=Playfair+Display:wght@500;700&display=swap" rel="stylesheet">
<style>
body{margin:0;font-family:'Montserrat',sans-serif;background:#0e0e11;color:#eaeaea;}
header{background:linear-gradient(rgba(0,0,0,.6),rgba(0,0,0,.9)),url('https://images.unsplash.com/photo-1500530855697-b586d89ba3ee');background-size:cover;background-position:center;padding:80px 20px;text-align:center;}
header h1{font-family:'Playfair Display',serif;font-size:52px;margin:0;}
nav{background:#15151c;padding:12px;display:flex;gap:15px;align-items:center;flex-wrap:wrap;}
nav a{cursor:pointer;font-weight:600;}
#searchBox{margin-left:auto;position:relative;}
#searchInput{padding:8px 10px;border-radius:20px;border:none;width:220px;}
#searchResults{position:absolute;top:38px;background:#1c1c25;width:100%;border-radius:10px;display:none;z-index:10;}
.search-item{padding:10px;cursor:pointer;}
.search-item:hover{background:#2a2a35;}
main{max-width:900px;margin:auto;padding:20px;}
.card{background:#1c1c25;padding:20px;border-radius:10px;margin-bottom:20px;}
.hidden{display:none}
#single img, #single iframe{max-width:100%;height:auto;object-fit:cover;border-radius:10px;margin:15px 0;}
#singleContent{line-height:1.7;}
#chatBox{display:none;position:fixed;bottom:20px;right:20px;width:350px;height:500px;background:#1c1c25;border-radius:10px;box-shadow:0 10px 25px rgba(0,0,0,0.4);overflow:hidden;flex-direction:column;z-index:1000;}
#chatMessages{flex-grow:1;padding:10px;overflow-y:auto;}
#chatInput{flex-grow:1;padding:10px;border:none;background:#0e0e11;color:#fff;outline:none;}
#chatSend{padding:0 15px;border:none;background:#ff4d4d;color:#fff;cursor:pointer;font-weight:600;}
</style>

<!-- Webpushr -->
<script>
(function(w,d,s,id){
  if(typeof(w.webpushr)!=='undefined') return;
  w.webpushr=w.webpushr||function(){
    (w.webpushr.q=w.webpushr.q||[]).push(arguments)
  };
  var js,fjs=d.getElementsByTagName(s)[0];
  js=d.createElement(s); js.id=id; js.async=1;
  js.src="https://cdn.webpushr.com/app.min.js";
  js.onload=function(){
    webpushr('setup',{
      'key':'BKdp3zSvl_w5aJH_c9naFADnGMJxh9khCwh0THm4hfU-PGhMZN8V5XpQt0nAqFULqVBjWSUk6lWblBhDYRbhWt4'
    });
  };
  fjs.parentNode.appendChild(js);
}(window,document,'script','webpushr-jssdk'));
</script>
</head>

<body>
<header>
  <h1>RSM</h1>
</header>

<nav>
  <a onclick="showSection('home')">Home</a>
  <a onclick="showSection('articles')">Articoli</a>
  <a onclick="showSection('videos')">Video</a>
  <a onclick="showSection('news')">News</a>
  <a onclick="showSection('categories')">Categorie</a>
  <a onclick="showSection('about')">Chi siamo?</a>
  <a onclick="showSection('contacts')">Contatti</a>

  <div id="searchBox">
    <input id="searchInput" placeholder="Cerca..." oninput="searchAll()">
    <div id="searchResults"></div>
  </div>

 <!-- Chatbot AI -->
<div id="chatBotContainer" style="position:relative; margin-left:15px;">
  <button id="chatToggle" style="padding:8px 12px; border:none; border-radius:20px; background:#ff4d4d; color:#fff; cursor:pointer; font-weight:600;">
    Chat AI
  </button>
  
  <div id="chatBox" style="display:none; position:fixed; bottom:20px; right:20px; width:350px; height:500px; background:#1c1c25; border-radius:10px; box-shadow:0 10px 25px rgba(0,0,0,0.4); overflow:hidden; flex-direction:column; z-index:1000;">
    
    <div style="background:#15151c; padding:12px 15px; display:flex; align-items:center; border-bottom:1px solid #333;">
      <button id="chatClose" style="background:#ff4d4d; color:white; border:none; width:30px; height:30px; border-radius:50%; cursor:pointer; display:flex; align-items:center; justify-content:center; font-weight:bold; margin-right:10px;">
        √ó
      </button>
      <span style="color:#fff; font-weight:600;">ü§ñ Assistente RSM</span>
    </div>
    
    <div id="chatMessages" style="flex:1; overflow-y:auto; padding:15px;"></div>
    
    <div style="border-top:1px solid #333; padding:12px; background:#15151c;">
      <div style="display:flex; gap:8px;">
        <input id="chatInput" type="text" placeholder="Scrivi qui..." autocomplete="off" 
               style="flex:1; padding:10px; background:#0e0e11; color:#fff; border:none; border-radius:6px; outline:none;">
        <button id="chatSend" style="padding:0 15px; background:#4da6ff; color:#fff; border:none; border-radius:6px; cursor:pointer; font-weight:600;">
          Invia
        </button>
      </div>
    </div>
  </div>
</div>
</nav>

<main>
<section id="home">
  <div id="latestNews" class="card" style="border-left:5px solid #ff4d4d">
    <h2>üü• Ultima notizia</h2>
    <h3 id="latestTitle"></h3>
    <p style="opacity:.7">Clicca per leggere la notizia completa</p>
  </div>
  <div id="latestVideo" class="card" style="border-left:5px solid #4da6ff">
    <h2>üé¨ Ultimo video</h2>
    <h3 id="latestVideoTitle"></h3>
    <p style="opacity:.7">Clicca per guardare il video completo</p>
  </div>
</section>

<section id="articles" class="hidden"></section>
<section id="videos" class="hidden"></section>
<section id="news" class="hidden"></section>
<section id="categories" class="hidden"></section>

<section id="about" class="hidden">
  <div class="card">
    <h2>Chi siamo?</h2>
    <p id="publicDescription"></p>
  </div>
</section>

<section id="contacts" class="hidden">
  <div class="card">
    <h2>Contatti</h2>
    <p>üìû +39 351 093 3272</p>
    <p>üìß rsm260511@gmail.com</p>
  </div>
</section>

<section id="single" class="hidden card">
  <h2 id="singleTitle"></h2>
  <p id="singleDate" style="opacity:.6;font-size:14px;margin-top:-10px"></p>
  <div id="singleImage"></div>
  <div id="singleContent"></div>
</section>
</main>

<footer style="text-align:center;padding:20px;font-size:14px;opacity:.6">
¬© 2025 ‚Äì RSM | Tutti i diritti riservati
</footer>
<script>
// DATI
let articles=[];
fetch('https://raw.githubusercontent.com/rsm260511-web/RSM/main/data.json')
.then(r=>r.json())
.then(data=>{
  document.getElementById('publicDescription').innerText=data.description;
  articles = data.articles;
  renderArticles();
  renderVideos();
  renderNews();
  renderCategories();
  renderLatestNews();
  renderLatestVideo();
});

// SEZIONI
function showSection(id){
  document.querySelectorAll('main section').forEach(s=>s.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
  window.scrollTo(0,0);
}

// RENDER ARTICOLI, VIDEO, NEWS, CATEGORIE
function renderArticles() {
    const c = document.getElementById('articles');
    c.innerHTML = '';
    articles.filter(a => a.type === "article").forEach(a => {
        const i = articles.indexOf(a);
        const d = document.createElement('div');
        d.className = 'card';
        d.innerHTML = `<h2>${a.title}</h2>`;
        d.onclick = () => openArticle(i);
        c.appendChild(d);
    });
}

function renderVideos() {
    const c = document.getElementById('videos');
    c.innerHTML = '';
    articles.filter(a => a.type === "video").forEach(a => {
        const i = articles.indexOf(a);
        const d = document.createElement('div');
        d.className = 'card';
        d.innerHTML = `<h2>${a.title}</h2>`;
        d.onclick = () => openVideo(i);
        c.appendChild(d);
    });
}

function renderNews() {
    const c = document.getElementById('news');
    c.innerHTML = '';
    articles.filter(a => a.type === "news").forEach(a => {
        const i = articles.indexOf(a);
        const d = document.createElement('div');
        d.className = 'card';
        d.innerHTML = `<h2>${a.title}</h2>`;
        d.onclick = () => openArticle(i);
        c.appendChild(d);
    });
}

function renderCategories() {
    const c = document.getElementById('categories');
    c.innerHTML = '';
    [...new Set(articles.map(a => a.category))].forEach(cat => {
        const box = document.createElement('div');
        box.className = 'card';
        box.innerHTML = `<h2>${cat}</h2>`;
        articles.filter(a => a.category === cat).forEach(a => {
            const i = articles.indexOf(a);
            const p = document.createElement('p');
            p.style.cursor = 'pointer';
            p.innerText = "‚Ä¢ " + a.title;
            p.onclick = () => {
                if (a.type === "video") {
                    openVideo(i);
                } else {
                    openArticle(i);
                }
            };
            box.appendChild(p);
        });
        c.appendChild(box);
    });
  }

// OPEN ARTICOLI/VIDEO - VIDEO PI√ô GRANDE
function openArticle(i){
  const a=articles[i]; 
  showSection('single'); 
  document.getElementById('singleTitle').innerText=a.title; 
  document.getElementById('singleDate').innerText=a.date?("üìÖ Pubblicato il "+new Date(a.date).toLocaleDateString('it-IT')):""; 
  const imgBox=document.getElementById('singleImage'); 
  imgBox.innerHTML=''; 
  if(a.images && Array.isArray(a.images)){ 
    a.images.forEach(src=>{
      const img=document.createElement('img'); 
      img.src=src;
      imgBox.appendChild(img);
    }); 
  } else if(a.image){
    imgBox.innerHTML=`<img src="${a.image}">`; 
  } 
  document.getElementById('singleContent').innerHTML=`<p>${a.content.replace(/\n/g,"<br><br>")}</p>`;
}

function openVideo(i){
  const a=articles[i]; 
  showSection('single'); 
  document.getElementById('singleTitle').innerText=a.title; 
  document.getElementById('singleDate').innerText=a.date?("üìÖ Pubblicato il "+new Date(a.date).toLocaleDateString('it-IT')):""; 
  const imgBox=document.getElementById('singleImage'); 
  imgBox.innerHTML=''; 
  
  if(a.videoUrl){ 
    // VIDEO MOLTO PI√ô GRANDE
    imgBox.innerHTML=`
      <div style="width:100%; max-width:100%; margin:20px 0;">
        <iframe width="100%" height="200" src="${a.videoUrl}" 
                frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                allowfullscreen style="border-radius:10px;">
        </iframe>
      </div>
    `;
  } else if(a.images && Array.isArray(a.images)){ 
    a.images.forEach(src=>{
      const img=document.createElement('img'); 
      img.src=src;
      imgBox.appendChild(img);
    }); 
  } 
  document.getElementById('singleContent').innerHTML=`<p>${a.content.replace(/\n/g,"<br><br>")}</p>`;
}

// SEARCH
function searchAll(){
  const q=searchInput.value.toLowerCase(); 
  const box=searchResults; 
  box.innerHTML=''; 
  if(!q){
    box.style.display='none'; 
    return;
  } 
  articles.forEach((a,i)=>{
    if(a.title.toLowerCase().includes(q) || a.content.toLowerCase().includes(q)){
      const d=document.createElement('div'); 
      d.className='search-item'; 
      d.innerText=a.title; 
      d.onclick=()=>{
        if (a.type === "video") {
          openVideo(i);
        } else {
          openArticle(i);
        }
      }; 
      box.appendChild(d);
    }
  }); 
  box.style.display=box.children.length?'block':'none';
}

// LATEST NEWS & VIDEO
function renderLatestNews(){
  const news=articles.filter(a=>a.type==="news").sort((a,b)=>new Date(b.date)-new Date(a.date))[0]; 
  if(!news) return; 
  document.getElementById('latestTitle').innerText=news.title; 
  const i=articles.findIndex(a=>a.title===news.title); 
  document.getElementById('latestNews').onclick=()=>openArticle(i);
}

function renderLatestVideo(){
  const video=articles.filter(a=>a.type==="video").sort((a,b)=>new Date(b.date)-new Date(a.date))[0]; 
  if(!video) return; 
  document.getElementById('latestVideoTitle').innerText=video.title; 
  const i=articles.findIndex(a=>a.title===video.title); 
  document.getElementById('latestVideo').onclick=()=>openVideo(i);
}

// ============ CHATBOT AI ============
const chatToggle = document.getElementById('chatToggle');
const chatBox = document.getElementById('chatBox');
const chatMessages = document.getElementById('chatMessages');
const chatInput = document.getElementById('chatInput');
const chatSend = document.getElementById('chatSend');

let lastQuestion = null;

// Apri/Chiudi chat
chatToggle.addEventListener('click', () => {
  chatBox.style.display = chatBox.style.display === 'flex' ? 'none' : 'flex';
  if (chatBox.style.display === 'flex') chatInput.focus();
});

const chatClose = document.getElementById('chatClose');
chatClose.addEventListener('click', () => {
  chatBox.style.display = 'none';
});

// Aggiungi messaggio
function appendMessage(sender, text) {
  const div = document.createElement('div');
  div.innerHTML = text.replace(/\n/g, '<br>');
  div.style.margin = '5px';
  div.style.padding = '8px 12px';
  div.style.borderRadius = '15px';
  div.style.maxWidth = '80%';
  div.style.wordWrap = 'break-word';
  div.style.alignSelf = sender === 'user' ? 'flex-end' : 'flex-start';
  div.style.background = sender === 'user' ? '#007bff' : '#333';
  div.style.color = '#fff';
  chatMessages.appendChild(div);
  chatMessages.scrollTop = chatMessages.scrollHeight;
}

// Invio messaggio ASINCRONO
async function sendMessage() {
  const msg = chatInput.value.trim();
  if (!msg) return;
  
  appendMessage('user', msg);
  
  // Risposta AI
  const botReply = await botResponse(msg);
  appendMessage('bot', botReply);
  
  chatInput.value = '';
  chatInput.focus();
}

chatSend.addEventListener('click', sendMessage);
chatInput.addEventListener('keypress', e => {
  if (e.key === 'Enter') sendMessage();
});

function randomChoice(arr) {
  return arr[Math.floor(Math.random() * arr.length)];
}

// ============ WIKIPEDIA SEARCH ============
async function wikipediaSearch(query) {
  try {
    const searchUrl = `https://it.wikipedia.org/w/api.php?action=query&list=search&srsearch=${encodeURIComponent(query)}&format=json&origin=*&srlimit=1`;
    
    const searchResponse = await fetch(searchUrl);
    const searchData = await searchResponse.json();
    
    if (!searchData.query?.search?.length) {
      return "üîç Non ho trovato informazioni su questo argomento.";
    }
    
    const pageTitle = searchData.query.search[0].title;
    const contentUrl = `https://it.wikipedia.org/w/api.php?action=query&prop=extracts&exintro=true&explaintext=true&titles=${encodeURIComponent(pageTitle)}&format=json&origin=*`;
    
    const contentResponse = await fetch(contentUrl);
    const contentData = await contentResponse.json();
    
    const pages = contentData.query.pages;
    const pageId = Object.keys(pages)[0];
    
    if (pageId === "-1" || !pages[pageId].extract) {
      return `üìö **${pageTitle}**\n\nInformazioni limitate su questo argomento.`;
    }
    
    const extract = pages[pageId].extract;
    const shortExtract = extract.length > 400 ? extract.substring(0, 400) + "..." : extract;
    
    return `üìö **${pageTitle}**\n\n${shortExtract}`;
    
  } catch (error) {
    return "‚ö†Ô∏è Impossibile effettuare la ricerca in questo momento.";
  }
}

// ============ RIASSUNTI INTELLIGENTI ============
function summarizeText(text, maxSentences = 3) {
  if (!text) return "Non c'√® testo da riassumere.";
  
  text = text.replace(/<[^>]*>/g, ' ').replace(/\s+/g, ' ').trim();
  const sentences = text.split(/[.!?]+/).filter(s => s.trim().length > 0);
  
  if (sentences.length <= maxSentences) {
    return sentences.join('. ') + '.';
  }
  
  const words = text.toLowerCase().split(/\s+/).filter(w => w.length > 3);
  const wordFreq = {};
  words.forEach(w => wordFreq[w] = (wordFreq[w] || 0) + 1);
  
  const scoredSentences = sentences.map(sentence => {
    const sentenceWords = sentence.toLowerCase().split(/\s+/);
    let score = 0;
    sentenceWords.forEach(w => {
      if (wordFreq[w]) score += wordFreq[w];
    });
    return { sentence: sentence.trim(), score: score / sentenceWords.length };
  });
  
  scoredSentences.sort((a, b) => b.score - a.score);
  const bestSentences = scoredSentences.slice(0, maxSentences);
  bestSentences.sort((a, b) => sentences.indexOf(a.sentence) - sentences.indexOf(b.sentence));
  
  return bestSentences.map(s => s.sentence).join('. ') + '.';
}

// Trova articolo per titolo
function findArticleByTitle(title) {
  const searchTitle = title.toLowerCase().trim();
  return articles.find(a => 
    a.title.toLowerCase().includes(searchTitle) || 
    searchTitle.includes(a.title.toLowerCase())
  );
}

// ============ SISTEMA INTELLIGENTE DI COMANDI ============
const intelligentCommands = {
  // COMANDI PERSONALI (risposte fisse e precise)
  "come ti chiami": "ü§ñ Mi chiamo **Assistente RSM**! Sono l'AI intelligente del sito RSM.",
  "tu come ti chiami": "ü§ñ Mi chiamo **Assistente RSM**! Creato per aiutarti.",
  "qual √® il tuo nome": "ü§ñ Il mio nome √® **Assistente RSM**!",
  "hai un nome": "ü§ñ S√¨! Mi chiamo **Assistente RSM**.",
  "ti chiami come": "ü§ñ **Assistente RSM**! Questo √® il mio nome.",
  
  "cosa sei": "‚ö° Sono un **assistente AI avanzato** integrato nel sito RSM.",
  "chi sei": "‚ö° Sono **Assistente RSM**, il tuo aiutante AI personale!",
  "sei un ai": "‚úÖ Esatto! Sono un **AI intelligente** creato per assisterti.",
  "che cosa sei": "‚ö° Sono l'**Assistente AI** del sito RSM, sempre pronto ad aiutarti.",
  
  "cosa puoi fare": "‚ú® **Posso:**\n‚Ä¢ üîç Cercare informazioni su Wikipedia\n‚Ä¢ üìù Riassumere articoli e testi\n‚Ä¢ üó∫Ô∏è Guidarti tra Articoli/Video/News\n‚Ä¢ üí¨ Rispondere alle tue domande",
  "capacit√†": "‚ú® **Le mie capacit√†:**\n‚Ä¢ Ricerche intelligenti\n‚Ä¢ Riassunti automatici\n‚Ä¢ Navigazione assistita\n‚Ä¢ Supporto 24/7",
  "come aiuti": "‚ú® **Ti aiuto con:**\n1) Ricerche di informazioni\n2) Riassunti di contenuti\n3) Navigazione nel sito\n4) Risposte a domande",
  
  "chi ti ha creato": "üë®‚Äçüíª Sono stato sviluppato dal **team RSM** per offrire assistenza intelligente.",
  "creatore": "üë®‚Äçüíª Il mio creatore √® il **team RSM**.",
  "chi ti ha sviluppato": "üë®‚Äçüíª Sono stato sviluppato da **RSM** per assistere gli utenti.",
  
  "sei intelligente": "üß† **S√¨, molto!** Sono progettato per capire il contesto e fornire risposte utili.",
  "quanto sei smart": "üß† **Estremamente smart!** Riesco a interpretare le tue richieste in modo intelligente.",
  "sei bravo": "üòä **Grazie!** Cerco sempre di fare del mio meglio per aiutarti.",
  
  "grazie": "üôè **Di nulla!** √à un piacere aiutarti. üòä",
  "thank you": "üôè **You're welcome!** Happy to help! üòä",
  "ti ringrazio": "üôè **Prego!** Se hai bisogno di altro, sono qui. üòä",
  
  "addio": "üëã **Arrivederci!** Torna quando vuoi!",
  "arrivederci": "üëã **A presto!** Sar√≤ qui se mi cerchi.",
  "ciao ciao": "üëã **Ciao!** Ci vediamo alla prossima.",
  
  "aiuto": "üÜò **Ecco cosa posso fare:**\n‚Ä¢ 'cerca [argomento]' - ricerche\n‚Ä¢ 'riassumi' - riassunti articoli\n‚Ä¢ 'articoli/video/news' - navigazione\n‚Ä¢ Fammi qualsiasi domanda!",
  "help": "üÜò **I can help with:**\n‚Ä¢ 'search [topic]' - searches\n‚Ä¢ 'summarize' - summarize articles\n‚Ä¢ 'articles/videos/news' - navigation\n‚Ä¢ Ask me anything!",
  
  // COMANDI SPECIALI CHE ATTIVANO AZIONI
  "riassumi": "SUMMARY",
  "sintetizza": "SUMMARY",
  "fai un riassunto": "SUMMARY",
  "riassunto di": "SUMMARY",
  
  "cerca": "SEARCH",
  "trova": "SEARCH", 
  "ricerca": "SEARCH",
  "informazioni su": "SEARCH",
  "dimmi di": "SEARCH",
  "parlami di": "SEARCH",
  
  "cos'√®": "WHATIS",
  "che cos'√®": "WHATIS",
  "chi √®": "WHOIS",
  "cosa sono": "WHATIS",
  "chi era": "WHOIS",
  "significato di": "WHATIS",
  "definizione di": "WHATIS"
};

// ============ BOT RESPONSE INTELLIGENTISSIMO ============
async function botResponse(msg) {
  const m = msg.toLowerCase().trim();
  
  // 1. SALUTI
  const saluti = ["ciao", "buongiorno", "buon giorno", "buonasera", "buona sera", "buon pomeriggio", "hi", "hello", "salve", "hey"];
  
  if (m.split(/\s+/).length <= 2) {
    for (const saluto of saluti) {
      if (m === saluto || m.startsWith(saluto + " ")) {
        return "üëã Ciao! Sono l'Assistente RSM. Posso cercare informazioni, riassumere articoli e aiutarti a navigare!";
      }
    }
  }
  
  // 2. SISTEMA DI COMANDI INTELLIGENTE (PRIMA DI TUTTO)
  for (const [command, response] of Object.entries(intelligentCommands)) {
    if (m.includes(command)) {
      // Comando SPECIALE: RIASSUNTI
      if (response === "SUMMARY") {
        if (!document.getElementById('single').classList.contains('hidden')) {
          const articleContent = document.getElementById('singleContent').innerText;
          if (articleContent) {
            const summary = summarizeText(articleContent);
            return `üìù **Riassunto:**\n\n${summary}`;
          }
        }
        
        const titleMatch = m.replace(/riassumi|sintetizza|fai un riassunto|riassunto di/gi, '').trim();
        if (titleMatch) {
          const article = findArticleByTitle(titleMatch);
          if (article) {
            const summary = summarizeText(article.content);
            return `üìù **Riassunto di "${article.title}":**\n\n${summary}`;
          }
        }
        
        return "Per riassumere un articolo, apri prima l'articolo o scrivi 'riassumi [titolo articolo]'.";
      }
      
      // Comando SPECIALE: RICERCHE
      if (response === "SEARCH" || response === "WHATIS" || response === "WHOIS") {
        let searchQuery = m.replace(command, '').trim();
        searchQuery = searchQuery.replace(/[?.,!;:]/g, '').trim();
        
        if (searchQuery.length > 2) {
          return await wikipediaSearch(searchQuery);
        }
        return "Cosa vuoi che cerchi? Scrivi 'cerca [argomento]' per una ricerca.";
      }
      
      // Risposta FISSA per comandi personali
      return response;
    }
  }
  
  // 3. NAVIGAZIONE SITO
  const navigazione = {
    "articoli": {section: 'articles', emoji: 'üìÑ'},
    "video": {section: 'videos', emoji: 'üé¨'},
    "news": {section: 'news', emoji: 'üì∞'},
    "notizie": {section: 'news', emoji: 'üì∞'},
    "categorie": {section: 'categories', emoji: 'üè∑Ô∏è'},
    "chi siamo": {section: 'about', emoji: 'üë•'},
    "contatti": {section: 'contacts', emoji: 'üìû'},
    "home": {section: 'home', emoji: 'üè†'}
  };
  
  for (const [keyword, info] of Object.entries(navigazione)) {
    if (m.includes(keyword)) {
      lastQuestion = `Vuoi aprire la sezione ${keyword}?`;
      return `${info.emoji} ${lastQuestion}\n\nD√¨ **'S√¨'** per confermare o **'No'** per annullare.`;
    }
  }
  
  // 4. GESTIONE S√å/NO
  if (lastQuestion) {
    if (m.includes("s√¨") || m.includes("si") || m.includes("yes") || m === "s" || m === "ok") {
      const question = lastQuestion;
      lastQuestion = null;
      
      for (const [keyword, info] of Object.entries(navigazione)) {
        if (question.includes(keyword)) {
          showSection(info.section);
          return `‚úÖ ${info.emoji} **Sezione ${keyword} aperta!**`;
        }
      }
    }
    
    if (m.includes("no") || m.includes("non") || m.includes("nope") || m === "n") {
      lastQuestion = null;
      return "üëå Va bene, operazione annullata.";
    }
  }
  
  // 5. RICERCA AUTOMATICA SE DOMANDA LUNGA
  if (m.includes("?") && m.length > 10) {
    let searchQuery = m.replace(/[?.,!]/g, '').trim();
    if (searchQuery.length > 5) {
      return await wikipediaSearch(searchQuery);
    }
  }
  
  // 6. RISPOSTE INTELLIGENTI
  if (m.includes("?")) {
    return "ü§î √à una domanda interessante! Prova a chiedermi 'cerca [argomento]' per una risposta dettagliata.";
  }
  
  // 7. SUGGERIMENTI
  const suggestions = [
    "üí° **Prova:** 'cerca informazioni su...' per ricerche, oppure 'riassumi' se hai un articolo aperto!",
    "üåü **Esempi:** 'cos'√® l'IA?', 'chi √® Leonardo da Vinci?', 'articoli', 'video'",
    "üöÄ **Posso:** cercare informazioni, riassumere contenuti, guidarti nel sito!",
    "üîç **Digita:** 'cerca [argomento]' per ricerche, oppure 'aiuto' per vedere cosa posso fare."
  ];
  
  return randomChoice(suggestions);
}

// ============ API CORRETTE E FUNZIONANTI ============

// 1. CITAZIONI IN ITALIANO
async function getRandomQuote() {
  const citazioni = [
    "La semplicit√† √® l'ultima sofisticazione. ‚Äî Leonardo da Vinci",
    "Chi non risica, non rosica. ‚Äî Proverbio italiano", 
    "Il mondo √® un libro e quelli che non viaggiano ne leggono solo una pagina. ‚Äî Sant'Agostino",
    "La vita √® come andare in bicicletta: per mantenere l'equilibrio devi muoverti. ‚Äî Albert Einstein",
    "Il segreto per andare avanti √® iniziare. ‚Äî Mark Twain",
    "Meglio un uovo oggi che una gallina domani. ‚Äî Proverbio italiano",
    "Chi trova un amico trova un tesoro. ‚Äî Proverbio italiano",
    "A caval donato non si guarda in bocca. ‚Äî Proverbio italiano"
  ];
  return `üí¨ **Citazione:**\n${citazioni[Math.floor(Math.random() * citazioni.length)]}`;
}

// 2. BARZELLETTE IN ITALIANO (API funzionante)
async function getRandomJoke() {
  try {
    const res = await fetch('https://v2.jokeapi.dev/joke/Any?lang=it&safe-mode');
    const data = await res.json();
    
    if (data.type === 'single') {
      return `üòÇ **Barzelletta:**\n${data.joke}`;
    } else if (data.type === 'twopart') {
      return `üòÇ **Barzelletta:**\n${data.setup}\n\n${data.delivery}`;
    }
    throw new Error('Formato non supportato');
  } catch {
    // Fallback locale
    const barzellette = [
      "Perch√© il libro di matematica √® triste? Perch√© ha troppi problemi.",
      "Cosa dice un computer a un altro? I miei bit sono pi√π veloci dei tuoi!",
      "Perch√© il programmatore non beve il t√®? Perch√© temeva il C++.",
      "Qual √® il colmo per un calciatore? Giocare in Premier League e chiamarsi Fuorigioco.",
      "Come fa un informatico a spegnere la luce? Dice: 'Ctrl+Alt+Del'."
    ];
    return `üòÇ **Barzelletta:**\n${barzellette[Math.floor(Math.random() * barzellette.length)]}`;
  }
}

// 3. CONSIGLI IN ITALIANO
async function getRandomAdvice() {
  const consigli = [
    "Non rimandare a domani quello che puoi fare oggi.",
    "Ascolta due volte prima di parlare una volta.",
    "Meglio un uovo oggi che una gallina domani.",
    "Chi trova un amico trova un tesoro.",
    "La pazienza √® la virt√π dei forti.",
    "L'abito non fa il monaco.",
    "Chi va piano, va sano e va lontano.",
    "A caval donato non si guarda in bocca.",
    "Tra il dire e il fare c'√® di mezzo il mare.",
    "Il buongiorno si vede dal mattino."
  ];
  return `üí° **Consiglio:**\n${consigli[Math.floor(Math.random() * consigli.length)]}`;
}

// 4. CAMBIO VALUTA
async function getExchangeRate() {
  try {
    const res = await fetch('https://api.exchangerate-api.com/v4/latest/EUR');
    const data = await res.json();
    return `üí± **Cambio valuta:**\n‚Ä¢ 1 EUR = ${data.rates.USD.toFixed(4)} USD\n‚Ä¢ 1 EUR = ${data.rates.GBP.toFixed(4)} GBP`;
  } catch {
    return "üí± **Cambio valuta:**\n‚Ä¢ 1 EUR ‚âà 1.09 USD\n‚Ä¢ 1 EUR ‚âà 0.86 GBP";
  }
}

// ============ AGGIORNAMENTO BOT RESPONSE PER API ============
// Estendiamo la funzione botResponse per gestire le API
const originalBotResponse = botResponse;
botResponse = async function(msg) {
  const m = msg.toLowerCase().trim();
  
  // Gestione nuove API
  if (m.includes("citazione") || m.includes("frasi famose")) {
    return await getRandomQuote();
  }
  
  if (m.includes("barzelletta") || m.includes("scherzo") || m.includes("battuta")) {
    return await getRandomJoke();
  }
  
  if (m.includes("consiglio") || m.includes("suggerimento")) {
    return await getRandomAdvice();
  }
  
  if (m.includes("cambio") || m.includes("valuta") || m.includes("euro") || m.includes("dollaro")) {
    return await getExchangeRate();
  }
  
  // Se non √® un comando API, usa la risposta originale
  return await originalBotResponse(msg);
};
</script>
</body>
</html>
